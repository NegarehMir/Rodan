Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))},Storage.prototype.getObject=function(e){var t=this.getItem(e);return t&&JSON.parse(t)},function(e){var t=1;e.generateId=function(e){var i;do i=t++ +(e?"-"+e:"");while(document.getElementById(i));return i}}(jQuery),function(e){e.getScrollbarWidth=function(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var i=e.offsetWidth;t.style.overflow="scroll";var a=e.offsetWidth;return i==a&&(a=t.clientWidth),document.body.removeChild(t),i-a}}(jQuery),function(e){e.getHashParam=function(e){var t=window.location.hash;if(""!==t){var i=t.indexOf("&"+e+"=")>0?t.indexOf("&"+e+"="):t.indexOf("#"+e+"=");if(i>=0){i+=e.length+2;var a=t.indexOf("&",i);return a>i?t.substring(i,a):0>a?t.substring(i):""}return!1}return!1}}(jQuery),function(e){e.updateHashParam=function(t,i){var a=e.getHashParam(t),n=window.location.hash;if(a!==i)if("string"==typeof a){var o=n.indexOf("&"+t+"=")>0?n.indexOf("&"+t+"="):n.indexOf("#"+t+"="),r=o+t.length+2+a.length,l=0===o?"#":"&";window.location.replace(n.substring(0,o)+l+t+"="+i+n.substring(r))}else 0===n.length?window.location.replace("#"+t+"="+i):window.location.replace(n+"&"+t+"="+i)}}(jQuery),function(e){e.fn.dragscrollable=function(t){var i=e.extend({dragSelector:">:first",acceptPropagatedEvent:!0,preventDefault:!0},t||{}),a={mouseDownHandler:function(t){return 1!=t.which||!t.data.acceptPropagatedEvent&&t.target!=this?!1:(t.data.lastCoord={left:t.clientX,top:t.clientY},e.event.add(document,"mouseup",a.mouseUpHandler,t.data),e.event.add(document,"mousemove",a.mouseMoveHandler,t.data),t.data.preventDefault?(t.preventDefault(),!1):void 0)},mouseMoveHandler:function(e){var t={left:e.clientX-e.data.lastCoord.left,top:e.clientY-e.data.lastCoord.top};return e.data.scrollable.scrollLeft(e.data.scrollable.scrollLeft()-t.left),e.data.scrollable.scrollTop(e.data.scrollable.scrollTop()-t.top),e.data.lastCoord={left:e.clientX,top:e.clientY},e.data.preventDefault?(e.preventDefault(),!1):void 0},mouseUpHandler:function(t){return e.event.remove(document,"mousemove",a.mouseMoveHandler),e.event.remove(document,"mouseup",a.mouseUpHandler),t.data.preventDefault?(t.preventDefault(),!1):void 0}};this.each(function(){var t={scrollable:e(this),acceptPropagatedEvent:i.acceptPropagatedEvent,preventDefault:i.preventDefault};e(this).find(i.dragSelector).bind("mousedown",t,a.mouseDownHandler)})}}(jQuery),function(e){"use strict";var t={cursor:"move",decelerate:!0,triggerHardware:!1,y:!0,x:!0,slowdown:.9,maxvelocity:40,throttleFPS:60,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}},i="kinetic-settings",a="kinetic-active";window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),e.support=e.support||{},e.extend(e.support,{touch:"ontouchend"in document});var n=function(){return!1},o=function(e,t){return 0===Math.floor(Math.abs(e))?0:e*t},r=function(e,t){var i=e;return e>0?e>t&&(i=t):0-t>e&&(i=0-t),i},l=function(e,t){this.removeClass(e.movingClass.up).removeClass(e.movingClass.down).removeClass(e.movingClass.left).removeClass(e.movingClass.right).removeClass(e.deceleratingClass.up).removeClass(e.deceleratingClass.down).removeClass(e.deceleratingClass.left).removeClass(e.deceleratingClass.right),e.velocity>0&&this.addClass(t.right),e.velocity<0&&this.addClass(t.left),e.velocityY>0&&this.addClass(t.down),e.velocityY<0&&this.addClass(t.up)},s=function(e,t){t.velocity=0,t.velocityY=0,t.decelerate=!0,"function"==typeof t.stopped&&t.stopped.call(e,t)},d=function(e,t){var i=e[0];t.x&&i.scrollWidth>0?(i.scrollLeft=t.scrollLeft=i.scrollLeft+t.velocity,Math.abs(t.velocity)>0&&(t.velocity=t.decelerate?o(t.velocity,t.slowdown):t.velocity)):t.velocity=0,t.y&&i.scrollHeight>0?(i.scrollTop=t.scrollTop=i.scrollTop+t.velocityY,Math.abs(t.velocityY)>0&&(t.velocityY=t.decelerate?o(t.velocityY,t.slowdown):t.velocityY)):t.velocityY=0,l.call(e,t,t.deceleratingClass),"function"==typeof t.moved&&t.moved.call(e,t),Math.abs(t.velocity)>0||Math.abs(t.velocityY)>0?window.requestAnimationFrame(function(){d(e,t)}):s(e,t)},c=function(t,a){var n=e.kinetic.callMethods[t],o=Array.prototype.slice.call(arguments);n&&this.each(function(){var t=o.slice(1),a=e(this).data(i);t.unshift(a),n.apply(this,t)})},u=function(t,i){t[0];e.support.touch?t.bind("touchstart",i.events.touchStart).bind("touchend",i.events.inputEnd).bind("touchmove",i.events.touchMove):t.mousedown(i.events.inputDown).mouseup(i.events.inputEnd).mousemove(i.events.inputMove),t.click(i.events.inputClick).scroll(i.events.scroll).bind("selectstart",n).bind("dragstart",i.events.dragStart)},g=function(t,i){t[0];e.support.touch?t.unbind("touchstart",i.events.touchStart).unbind("touchend",i.events.inputEnd).unbind("touchmove",i.events.touchMove):t.unbind("mousedown",i.events.inputDown).unbind("mouseup",i.events.inputEnd).unbind("mousemove",i.events.inputMove).unbind("scroll",i.events.scroll),t.unbind("click",i.events.inputClick).unbind("selectstart",n),t.unbind("dragstart",i.events.dragStart)},v=function(n){this.addClass(a).each(function(){var a=this,o=e(this);if(!o.data(i)){var s,c,g,v,h=e.extend({},t,n),f=!1,p=!1,m=!1,b=1e3/h.throttleFPS;h.velocity=0,h.velocityY=0;var w=function(){s=!1,c=!1,m=!1};e(document).mouseup(w).click(w);var I=function(){h.velocity=r(f-s,h.maxvelocity),h.velocityY=r(p-c,h.maxvelocity)},y=function(t){return e.isFunction(h.filterTarget)?h.filterTarget.call(a,t)!==!1:!0},x=function(e,t){m=!0,h.velocity=f=0,h.velocityY=p=0,s=e,c=t},P=function(){s&&f&&h.decelerate===!1&&(h.decelerate=!0,I(),s=f=m=!1,d(o,h))},D=function(t,i){(!g||new Date>new Date(g.getTime()+b))&&(g=new Date,m&&(s||c)&&(v&&(e(v).blur(),v=null,o.focus()),h.decelerate=!1,h.velocity=h.velocityY=0,o[0].scrollLeft=h.scrollLeft=h.x?o[0].scrollLeft-(t-s):o[0].scrollLeft,o[0].scrollTop=h.scrollTop=h.y?o[0].scrollTop-(i-c):o[0].scrollTop,f=s,p=c,s=t,c=i,I(),l.call(o,h,h.movingClass),"function"==typeof h.moved&&h.moved.call(o,h)))};h.events={touchStart:function(e){var t;y(e.target)&&(t=e.originalEvent.touches[0],x(t.clientX,t.clientY),e.stopPropagation())},touchMove:function(e){var t;m&&(t=e.originalEvent.touches[0],D(t.clientX,t.clientY),e.preventDefault&&e.preventDefault())},inputDown:function(e){y(e.target)&&(x(e.clientX,e.clientY),v=e.target,"IMG"===e.target.nodeName&&e.preventDefault(),e.stopPropagation())},inputEnd:function(e){P(),v=null,e.preventDefault&&e.preventDefault()},inputMove:function(e){m&&(D(e.clientX,e.clientY),e.preventDefault&&e.preventDefault())},scroll:function(e){"function"==typeof h.moved&&h.moved.call(o,h),e.preventDefault&&e.preventDefault()},inputClick:function(e){return Math.abs(h.velocity)>0?(e.preventDefault(),!1):void 0},dragStart:function(e){return v?!1:void 0}},u(o,h),o.data(i,h).css("cursor",h.cursor),h.triggerHardware&&o.css({"-webkit-transform":"translate3d(0,0,0)","-webkit-perspective":"1000","-webkit-backface-visibility":"hidden"})}})};e.kinetic={settingsKey:i,callMethods:{start:function(t,i){var a=e(this);t=e.extend(t,i),t&&(t.decelerate=!1,d(a,t))},end:function(t,i){e(this);t&&(t.decelerate=!0)},stop:function(t,i){var a=e(this);s(a,t)},detach:function(t,i){var n=e(this);g(n,t),n.removeClass(a).css("cursor","")},attach:function(t,i){var n=e(this);u(n,t),n.addClass(a).css("cursor","move")}}},e.fn.kinetic=function(e){return"string"==typeof e?c.apply(this,arguments):v.call(this,e),this}}(window.jQuery||window.Zepto);var diva=function(){var e={},t={Events:{publish:function(t,i,a){if(e[t]){var n=e[t];if("undefined"!=typeof n.global)for(var o=n.global,r=o.length;r--;)o[r].apply(a||this,i||[]);if(a&&"undefined"!=typeof a.getInstanceId){var l=a.getInstanceId();if(e[t][l])for(var s=e[t][l],d=s.length;d--;)s[d].apply(a||this,i||[])}}},subscribe:function(t,i,a){e[t]||(e[t]={}),"string"==typeof a?(e[t][a]||(e[t][a]=[]),e[t][a].push(i)):(e[t].global||(e[t].global=[]),e[t].global.push(i));var n=a?[t,i,a]:[t,i];return n},unsubscribe:function(t,i){var a=t[0];if(e[a]){var n;if(3===t.length&&"undefined"!=typeof e[a][t[2]]){var o=t[2];n=e[a][o]}else n=e[a].global;for(var r=n.length;r--;)if(n[r]===t[1])return n.splice(r,1),i&&delete n,!0}return!1},unsubscribeAll:function(t){if(t)for(var i,a=Object.keys(e),n=a.length;n--;)i=a[n],"undefined"!==e[i][t]&&delete e[i][t];else e={}}}};return t}(),activeDivaController=function(){var e;$(document).on("click",function(e){t($(e.target))});var t=function(t){var i,a,n=t.find(".diva-outer"),o=t.closest(".diva-outer"),r=document.getElementsByClassName("diva-outer"),l=r.length;if(n.length>0)i=n;else{if(!(o.length>0)){for(a=0;l>a;a++)$(r[a].parentElement).data("diva").deactivate();return}i=o}for(i.parent().data("diva").activate(),e=i.parent(),r=document.getElementsByClassName("diva-outer"),a=0;l>a;a++)r[a].getAttribute("id")!=i.attr("id")&&$(r[a].parentElement).data("diva").deactivate()};this.getActive=function(){return e}},activeDiva=new activeDivaController;window.divaPlugins=[],function(e){var t=function(t,i){var a={adaptivePadding:.05,arrowScrollAmount:40,blockMobileMove:!0,objectData:"",enableAutoTitle:!0,enableFilename:!0,enableFullscreen:!0,enableGotoPage:!0,enableGridIcon:!0,enableGridControls:"buttons",enableImageTitles:!0,enableKeyScroll:!0,enableLinkIcon:!0,enableSpaceScroll:!1,enableToolbar:!0,enableZoomControls:"buttons",fixedPadding:10,fixedHeightGrid:!0,goDirectlyTo:0,iipServerURL:"",inFullscreen:!1,inBookLayout:!1,inGrid:!1,imageDir:"",maxPagesPerRow:8,maxZoomLevel:-1,minPagesPerRow:2,minZoomLevel:0,pageLoadTimeout:200,pagesPerRow:5,rowLoadTimeout:50,throbberTimeout:100,tileHeight:256,tileWidth:256,toolbarParentObject:i.parentObject,verticallyOriented:!0,viewportMargin:200,zoomLevel:2},n=e.extend({},a,i),o={allTilesLoaded:[],averageHeights:[],averageWidths:[],currentPageIndex:0,doubleClickZoom:!1,documentPaged:!1,firstPageLoaded:-1,firstRowLoaded:-1,gridPageWidth:0,hashParamSuffix:"",horizontalOffset:0,horizontalPadding:0,ID:null,initialKeyScroll:!1,initialSpaceScroll:!1,innerObject:"",isActiveDiva:!0,isScrollable:!0,isIIIF:!1,itemTitle:"",lastPageLoaded:-1,lastRowLoaded:-1,loaded:!1,loadedTiles:[],maxWidths:[],maxHeights:[],maxRatio:0,minRatio:0,mobileWebkit:!1,numPages:0,numRows:0,oldZoomLevel:-1,outerObject:"",pages:[],pageLeftOffsets:[],pagePreloadCanvases:[],pageTopOffsets:[],pageTimeouts:[],pageTools:"",panelHeight:0,panelWidth:0,plugins:[],previousLeftScroll:0,previousTopScroll:0,realMaxZoom:-1,resizeTimer:-1,rowHeight:0,scaleWait:!1,scrollbarWidth:0,selector:"",singleClick:!1,singleTap:!1,throbberTimeoutID:-1,toolbar:null,totalHeights:[],totalHeight:0,totalWidths:[],totalWidth:0,verticalOffset:0,verticalPadding:0};e.extend(n,o);var r=this,l=function(e,t){return n.pages[e].d[n.zoomLevel][t]},s=function(e){var t,i=n.numPages;for(t=0;i>t;t++)if(n.pages[t].f===e)return t;return-1},d=function(e,t){var i=n.outerObject.scrollLeft()-n.viewportMargin,a=i+n.panelWidth+2*n.viewportMargin,o=e>=i&&a>=e,r=i>=e&&t>=a,l=t>=i&&a>=t;return o||r||l},c=function(e,t){var i=n.outerObject.scrollTop()-n.viewportMargin,a=i+n.panelHeight+2*n.viewportMargin,o=e>=i&&a>=e,r=i>=e&&t>=a,l=t>=i&&a>=t;return o||r||l},u=function(e,t,i,a){var o=i-n.viewportMargin,r=a+2*n.viewportMargin,l=e>=o&&r>=e,s=o>=e&&t>=r,d=t>=o&&r>=t;return l||s||d},g=function(e,t,i,a){var o=i-n.viewportMargin,r=a+2*n.viewportMargin,l=e>=o&&r>=e,s=o>=e&&t>=r,d=t>=o&&r>=t;return l||s||d},v=function(e,t,i,a){var o,r;n.verticallyOriented?(o=n.pageTopOffsets[e]+t*n.tileHeight+n.verticalPadding,r=n.pageLeftOffsets[e]+i*n.tileWidth):(o=n.pageTopOffsets[e]+t*n.tileHeight,r=n.pageLeftOffsets[e]+i*n.tileWidth+n.horizontalPadding);var l=o+n.tileHeight,s=r+n.tileWidth;return g(o,l,a.top,a.bottom)&&u(r,s,a.left,a.right)},h=function(e,t){for(var i=n.loadedTiles.length;i--;)if(n.loadedTiles[e][i]===t)return!0;return!1},f=function(e){return e>=0&&e<n.numPages},p=function(e){var t=n.pageTopOffsets[e],i=t+l(e,"h")+n.verticalPadding,a=n.pageLeftOffsets[e],o=a+l(e,"w")+n.horizontalPadding;return c(t,i)&&d(a,o)},m=function(e,t){var i=n.pageTopOffsets[e],a=i+l(e,"h")+n.verticalPadding,o=n.pageLeftOffsets[e],r=o+l(e,"w")+n.horizontalPadding;return g(i,a,t.top,t.bottom)&&u(o,r,t.left,t.right)},b=function(e){return!!document.getElementById(n.ID+"page-"+e)},w=function(e,t,i,a,o,r){function s(e,t,i,a,o){return function(){n.loadedTiles[e].push(t),d.drawImage(i,a,o)}}var d;try{d=o.getContext("2d")}catch(c){return He("Your browser lacks support for the <pre><canvas></pre> element. Please upgrade your browser. Error: "+c),!1}"undefined"==typeof r&&(r={left:n.outerObject.scrollLeft(),top:n.outerObject.scrollTop(),right:n.outerObject.scrollLeft()+n.panelWidth,bottom:n.outerObject.scrollTop()+n.panelHeight});var u,g,f,p,m,b,w,I,y,x,P,D,L,O,T=n.imageDir+"/",C=Math.ceil(l(e,"h")/n.tileWidth),E=Math.ceil(l(e,"w")/n.tileHeight),S=n.pages[e].m,z=n.iipServerURL+"?FIF="+T+t+"&JTL=",k=!0,j=0,M=a-(C-1)*n.tileHeight,H=i-(E-1)*n.tileWidth;o.width!==Math.floor(l(e,"w"))&&(o.width=Math.floor(l(e,"w")),o.height=Math.floor(l(e,"h"))),I=n.zoomLevel+S-n.realMaxZoom;var A=n.isIIIF?n.pages[e].url:z+I+",";if(n.isIIIF){O=Math.pow(2,S-I),x=n.tileHeight*O,P=n.tileWidth*O;var B=n.pages[e].api,R=B>=2?"default":"native",F="/0/"+R+".jpg";n.pages[e].hasOwnProperty("xoffset")?(D=n.pages[e].xoffset,L=n.pages[e].yoffset):(D=0,L=0)}else x=n.tileHeight,P=n.tileWidth;for(u=0;C>u;){for(g=0,f=u===C-1?M:n.tileHeight;E>g;)b=u*n.tileHeight,w=g*n.tileWidth,p=g===E-1?H:n.tileWidth,y=n.isIIIF?A+(g*P+D)+","+(u*x+L)+","+p*O+","+f*O+"/"+p+","+F:A+j,h(e,j,d,w,b)||(v(e,u,g,r)?(m=new Image,m.crossOrigin="anonymous",m.onload=s(e,j,m,w,b),m.src=y):k=!1),j++,g++;u++}n.allTilesLoaded[e]=k},I=function(e,t,i,a,o){var l=document.getElementById(n.ID+"page-"+e);if(null!==l&&p(e)){var s=document.getElementById(n.ID+"canvas-"+e);w(e,t,i,a,s),diva.Events.publish("PageDidLoad",[e,t,o],r)}},y=function(e){if(!(b(e)&&n.allTilesLoaded[e]||n.inBookLayout&&n.documentPaged&&!n.pages[e].paged)){var t="undefined"!=typeof n.pagePreloadCanvases[e],i=n.pages[e].f,a=Math.floor(l(e,"w")),o=Math.floor(l(e,"h")),s=n.pageTopOffsets[e]+n.verticalPadding,d=n.pageLeftOffsets[e]+n.horizontalPadding,c=n.selector+"page-"+e;if(!b(e)){var u=document.getElementById(n.ID+"inner"),g=document.createElement("div");g.id=n.ID+"page-"+e,g.classList.add("diva-page","diva-document-page"),g.setAttribute("data-index",e),g.setAttribute("data-filename",i),g.style.width=a+"px",g.style.height=o+"px",n.enableImageTitles&&(g.title="Page "+(e+1)),g.innerHTML=n.pageTools;var v;if(t?(v=n.pagePreloadCanvases[e],n.pagePreloadCanvases[e]=void 0):(v=document.createElement("canvas"),v.width=a,v.height=o),v.style.width=a+"px",v.style.height=o+"px",v.id=n.ID+"canvas-"+e,v.setAttribute("class","diva-canvas"),g.appendChild(v),n.verticallyOriented)if(g.style.top=s+"px",n.inBookLayout)if(g.style.left=d+"px",e%2)g.classList.add("diva-page-book-left");else{if(0===e){var h=document.createElement("div");h.id=n.ID+"page-placeholder",h.classList.add("diva-page","diva-document-page"),h.style.width=a+"px",h.style.height=o+"px",h.style.left=0-a+"px",h.style.border="1px solid #ccc",h.style.background="#fdfdfd",h.style.mozBoxSizing="border-box",h.style.webkitBoxSizing="border-box",h.style.boxSizing="border-box",g.appendChild(h)}g.classList.add("diva-page-book")}else g.classList.add("diva-page-vertical");else g.style.left=d+"px",g.classList.add("diva-page-horizontal");u.appendChild(g),diva.Events.publish("PageWillLoad",[e,i,c],r)}t||n.pageTimeouts.push(setTimeout(I,n.pageLoadTimeout,e,i,a,o))}},x=function(e,t){if("undefined"==typeof n.pagePreloadCanvases[e]){var i=n.pages[e].f,a=Math.floor(l(e,"w")),o=Math.floor(l(e,"h")),s=n.selector+"page-"+e,d=document.createElement("canvas");d.width=a,d.height=o;var c=document.getElementById(n.ID+"canvas-"+e);if(c){var u=d.getContext("2d");u.drawImage(c,0,0,a,o)}return w(e,i,a,o,d,t),diva.Events.publish("PageDidLoad",[e,i,s],r),d}},P=function(e){var t=document.getElementById(n.ID+"page-"+e);if(null!==t){for(;t.firstChild;)t.removeChild(t.firstChild);n.loadedTiles[e]=[],t.parentNode.removeChild(t)}},D=function(e){var t=n.pageTopOffsets[e]+l(e,"h")+n.verticalPadding,i=document.getElementById(n.ID+"outer").scrollTop;return i>t},L=function(e){var t=n.pageTopOffsets[e],i=document.getElementById(n.ID+"outer").scrollTop+n.panelHeight;return t>i},O=function(e){var t=n.pageLeftOffsets[e]+l(e,"w")+n.horizontalPadding,i=document.getElementById(n.ID+"outer").scrollLeft;return i>t},T=function(e){var t=n.pageLeftOffsets[e],i=document.getElementById(n.ID+"outer").scrollLeft+n.panelWidth;return t>i},C=function(e){return n.verticallyOriented?D(e):O(e)},E=function(e){return n.verticallyOriented?L(e):T(e)},S=function(e,t){f(e)&&(t>0?p(e)?(y(e),n.lastPageLoaded=e,S(n.lastPageLoaded+1,t)):f(e+1)&&p(e+1)?(y(e+1),n.lastPageLoaded=e+1,S(n.lastPageLoaded+1,t)):C(e)&&S(e+1,t):p(e)?(y(e),n.firstPageLoaded=e,S(n.firstPageLoaded-1,t)):f(e-1)&&p(e-1)?(y(e-1),n.firstPageLoaded=e-1,S(n.firstPageLoaded-1,t)):E(e)&&S(e-1,t))},z=function(e,t){t>0?f(e)&&C(e)&&(P(e),n.firstPageLoaded=e+1,z(n.firstPageLoaded,t)):f(e)&&E(e)&&(P(e),n.lastPageLoaded=e-1,z(n.lastPageLoaded,t))},k=function(e){var t;if(0>e)S(n.lastPageLoaded,e),V(-1),z(n.lastPageLoaded,e);else if(e>0)S(n.firstPageLoaded,e),V(1),z(n.firstPageLoaded,e);else{var i=n.lastPageLoaded;for(t=Math.max(n.firstPageLoaded,0);i>=t;t++)p(t)&&y(t)}var a=n.verticallyOriented?document.getElementById(n.ID+"outer").scrollTop:document.getElementById(n.ID+"outer").scrollLeft;diva.Events.publish("ViewerDidScroll",[a],r),e>0?diva.Events.publish("ViewerDidScrollDown",[a],r):0>e&&diva.Events.publish("ViewerDidScrollUp",[a],r)},j=function(e){return e>=0&&e<n.numRows},M=function(e){var t=n.rowHeight*e,i=t+n.rowHeight+n.fixedPadding;return c(t,i)},H=function(e){return!!document.getElementById(n.ID+"row-"+e)},A=function(e){if(!H(e)){var t=n.rowHeight*e+n.fixedPadding,i=document.getElementById(n.ID+"inner"),a=document.createElement("div");a.id=n.ID+"row-"+e,a.classList.add("diva-row"),a.style.height=n.rowHeight+"px",a.style.top=t+"px",i.appendChild(a);var o,s,d,c,u,g,v,h,p,m,b,w,I=n.imageDir+"/",y=n.pagesPerRow;for(o=0;y>o&&(s=e*n.pagesPerRow+o,f(s));o++){d=n.pages[s].f,c=l(s,"w"),u=l(s,"h"),g=n.fixedHeightGrid?(n.rowHeight-n.fixedPadding)*c/u:n.gridPageWidth,v=n.fixedHeightGrid?n.rowHeight-n.fixedPadding:g/c*u,h=parseInt(o*(n.fixedPadding+n.gridPageWidth)+n.fixedPadding,10),m=n.pages[s].api,b=m>=2?"default":"native",w=",/0/"+b+".jpg",g=parseInt(g,10),v=parseInt(v,10),h+=n.fixedHeightGrid?(n.gridPageWidth-g)/2:0,p=n.isIIIF?encodeURI(n.pages[s].url+"full/"+g+w):encodeURI(n.iipServerURL+"?FIF="+I+d+"&HEI="+(v+2)+"&CVT=JPEG"),n.pageTopOffsets[s]=t,n.pageLeftOffsets[s]=h;var x=document.createElement("div");x.id=n.ID+"page-"+s;var P=n.selector+"page-"+s;x.classList.add("diva-page","diva-grid-page"),x.style.width=g+"px",x.style.height=v+"px",x.style.left=h+"px",x.setAttribute("data-index",s),x.setAttribute("data-filename",d),n.enableImageTitles&&(x.title="Page "+(s+1)),a.appendChild(x),diva.Events.publish("PageWillLoad",[s,d,P],r),N(e,s,p,g,v)}}},B=function(e){var t=document.getElementById(n.ID+"row-"+e);if(null!==t){for(;t.firstChild;)t.removeChild(t.firstChild);t.parentNode.removeChild(t)}},R=function(e){var t=n.rowHeight*(e+1),i=document.getElementById(n.ID+"outer").scrollTop;return i>t},F=function(e){var t=n.rowHeight*e,i=document.getElementById(n.ID+"outer").scrollTop+n.panelHeight;return t>i},Z=function(e,t){t>0?j(e)&&(M(e)?(A(e),n.lastRowLoaded=e,Z(n.lastRowLoaded+1,t)):R(e)&&Z(e+1,t)):j(e)&&(M(e)?(A(e),n.firstRowLoaded=e,Z(n.firstRowLoaded-1,t)):F(e)&&Z(e-1,t))},W=function(e,t){t>0?j(e)&&R(e)&&(B(e),n.firstRowLoaded++,W(n.firstRowLoaded,t)):j(e)&&F(e)&&(B(e),n.lastRowLoaded--,W(n.lastRowLoaded,t))},G=function(e){0>e?(Z(n.firstRowLoaded,-1),Y(-1),W(n.lastRowLoaded,-1)):e>0&&(Z(n.lastRowLoaded,1),Y(1),W(n.firstRowLoaded,1));var t=document.getElementById(n.ID+"outer").scrollTop;diva.Events.publish("ViewerDidScroll",[t],r),e>0?diva.Events.publish("ViewerDidScrollDown",[t],r):0>e&&diva.Events.publish("ViewerDidScrollUp",[t],r)},N=function(e,t,i,a,o){var r=function(e,t,i,a,o){if(b(t)){var r=document.createElement("img");r.src=i,r.style.width=a+"px",r.style.height=o+"px",document.getElementById(n.ID+"page-"+t).appendChild(r)}};n.pageTimeouts.push(window.setTimeout(r,n.rowLoadTimeout,e,t,i,a,o))},V=function(e){var t=n.currentPageIndex,i=t+e;if(!f(i))return!1;var a=n.verticallyOriented?document.getElementById(n.ID+"outer").scrollTop+n.panelHeight/2:document.getElementById(n.ID+"outer").scrollLeft+n.panelWidth/2,o=document.getElementById(n.ID+"outer").scrollLeft+n.panelWidth/2,s=!1;n.selector+"page-"+i;if(0>e?n.verticallyOriented?i>=0&&n.pageTopOffsets[i]+l(i,"h")+n.verticalPadding>=a&&(s=!0):i>=0&&n.pageLeftOffsets[i]+l(i,"w")+n.horizontalPadding>=a&&(s=!0):e>0&&(n.verticallyOriented?n.pageTopOffsets[t]+l(t,"h")+n.verticalPadding<a&&(s=!0):n.pageLeftOffsets[t]+l(t,"w")+n.horizontalPadding<a&&(s=!0)),n.inBookLayout&&n.verticallyOriented){var d=t+1;if(f(d)&&d%2===0&&n.pageLeftOffsets[d]<o&&d!==n.currentPageIndex){n.currentPageIndex=d;var c=n.pages[d].f;diva.Events.publish("VisiblePageDidChange",[d,c],r)}}if(s){if(n.currentPageIndex=i,0!==e&&!V(e)){var c=n.pages[i].f;diva.Events.publish("VisiblePageDidChange",[i,c],r)}return!0}return!1},Y=function(e){var t=Math.floor(n.currentPageIndex/n.pagesPerRow),i=t+parseInt(e,10),a=document.getElementById(n.ID+"outer").scrollTop,o=a+n.panelHeight/2,l=!1;if(0>e?i>=0&&(n.rowHeight*t>=o||n.rowHeight*i>=a)&&(l=!0):e>0&&n.rowHeight*(t+1)<a&&j(i)&&(l=!0),l){if(n.currentPageIndex=i*n.pagesPerRow,0!==e&&!Y(e)){var s=n.currentPageIndex,d=n.pages[s].f;diva.Events.publish("VisiblePageDidChange",[s,d],r)}return!0}return!1},_=function(e){var t=me(e,"top"),i=be(e,"center");U(e,t,i)},X=function(e,t,i){i="undefined"!=typeof i?i:0,t="undefined"!=typeof t?t:0;var a=n.pageTopOffsets[e]+t,o=a-parseInt(n.panelHeight/2,10),r=n.pageLeftOffsets[e]+i,l=r-parseInt(n.panelWidth/2,10);return{top:o,left:l}},U=function(e,t,i){var a=X(e,t,i);if(n.outerObject.scrollTop(a.top),n.outerObject.scrollLeft(a.left),e!==n.currentPageIndex){n.currentPageIndex=e;var o=n.pages[e].f;diva.Events.publish("VisiblePageDidChange",[e,o],r)}diva.Events.publish("ViewerDidJump",[e],r)},q=function(e){var t=Math.floor(e/n.pagesPerRow),i=t*n.rowHeight;n.outerObject.scrollTop(i),n.currentPageIndex=e;var a=n.pages[e].f;diva.Events.publish("VisiblePageDidChange",[e,a],r)},K=function(){q(n.goDirectlyTo)},Q=function(e){return e>=n.minZoomLevel&&e<=n.maxZoomLevel?e:n.minZoomLevel},J=function(e){return e>=n.minPagesPerRow&&e<=n.maxPagesPerRow?e:n.maxPagesPerRow},$=function(){for(n.innerObject.css("transition",""),n.innerObject.css("transform",""),n.innerObject.css("pointer-events",""),n.innerObject.css("transform-origin",""),n.allTilesLoaded=[],n.outerObject.scrollTop(0),n.innerObject.empty(),n.firstPageLoaded=0,n.firstRowLoaded=-1,n.previousTopScroll=0,n.previousLeftScroll=0,clearTimeout(n.resizeTimer);n.pageTimeouts.length;)clearTimeout(n.pageTimeouts.pop())},ee=function(){n.inGrid?ne():ae()},te=function(e,t){var i,a=0,o=0;if(n.pageTopOffsets=[],n.pageLeftOffsets=[],n.inBookLayout){var r=!1;if(n.verticallyOriented)for(i=0;i<n.numPages;i++){if(n.pageTopOffsets[i]=a,r)n.pageLeftOffsets[i]=e/2-l(i,"w")-n.horizontalPadding;else if(n.pageLeftOffsets[i]=e/2-n.horizontalPadding,!n.documentPaged||n.pages[i].paged){var s=f(i-1)?Math.max(l(i,"h"),l(i-1,"h")):l(i,"h");a=n.pageTopOffsets[i]+s+n.verticalPadding}(!n.documentPaged||n.pages[i].paged)&&(r=!r)}else for(i=0;i<n.numPages;i++){n.pageTopOffsets[i]=parseInt((t-l(i,"h"))/2,10),n.pageLeftOffsets[i]=o;var d=l(i,"w"),c=r?0:n.horizontalPadding;o=n.pageLeftOffsets[i]+d+c,(!n.documentPaged||n.pages[i].paged)&&(r=!r)}}else for(i=0;i<n.numPages;i++)n.pageTopOffsets[i]=parseInt(n.verticallyOriented?a:(t-l(i,"h"))/2,10),n.pageLeftOffsets[i]=parseInt(n.verticallyOriented?(e-l(i,"w"))/2:o,10),a=n.pageTopOffsets[i]+l(i,"h")+n.verticalPadding,o=n.pageLeftOffsets[i]+l(i,"w")+n.horizontalPadding},ie=function(e){var t=n.inBookLayout?2*(n.maxWidths[e]+n.horizontalPadding):n.maxWidths[e]+2*n.horizontalPadding,i=n.maxHeights[e]+2*n.verticalPadding,a=Math.max(t,n.panelWidth),o=Math.max(i,n.panelHeight);return{widthToSet:a,heightToSet:o}},ae=function(){$(),diva.Events.publish("DocumentWillLoad",[n],r),n.zoomLevel=Q(n.zoomLevel);var e=n.zoomLevel,t=ie(e);n.totalHeight=n.totalHeights[e]+n.verticalPadding*(n.numPages+1),n.totalWidth=n.totalWidths[e]+n.horizontalPadding*(n.numPages+1),te(t.widthToSet,t.heightToSet);var i=document.getElementById(n.ID+"inner");n.verticallyOriented?(i.style.height=Math.round(n.totalHeight)+"px",i.style.width=Math.round(t.widthToSet)+"px"):(i.style.height=Math.round(t.heightToSet)+"px",i.style.width=Math.round(n.totalWidth)+"px");var a=n.numPages-1;if(n.inBookLayout)if(n.verticallyOriented){var o=a%2?l(a,"h"):Math.max(l(a,"h"),l(a-1,"h"));i.style.height=n.pageTopOffsets[a]+o+2*n.verticalPadding+"px"}else i.style.width=n.pageLeftOffsets[a]+l(a,"w")+2*n.horizontalPadding+"px";f(n.goDirectlyTo)||(n.goDirectlyTo=0),U(n.goDirectlyTo,n.verticalOffset,n.horizontalOffset);for(var s=!1,d=0;d<n.numPages;d++)if(p(d))y(d),n.lastPageLoaded=d,s=!0;else if(s)break;n.oldZoomLevel>=0?(n.oldZoomLevel<n.zoomLevel?diva.Events.publish("ViewerDidZoomIn",[e],r):diva.Events.publish("ViewerDidZoomOut",[e],r),diva.Events.publish("ViewerDidZoom",[e],r)):n.oldZoomLevel=n.zoomLevel,n.scaleWait&&(n.scaleWait=!1);var c=n.pages[n.currentPageIndex].f;diva.Events.publish("DocumentDidLoad",[n.currentPageIndex,c],r)},ne=function(){var e=n.currentPageIndex;n.verticalOffset=n.verticallyOriented?n.panelHeight/2:l(e,"h")/2,n.horizontalOffset=n.verticallyOriented?l(e,"w")/2:n.panelWidth/2,$(),n.pagesPerRow=J(n.pagesPerRow);var t=n.fixedPadding*(n.pagesPerRow+1),i=(n.panelWidth-t)/n.pagesPerRow;n.gridPageWidth=i,n.rowHeight=n.fixedHeightGrid?n.fixedPadding+n.minRatio*i:n.fixedPadding+n.maxRatio*i,n.numRows=Math.ceil(n.numPages/n.pagesPerRow),n.totalHeight=n.numRows*n.rowHeight+n.fixedPadding;var a=document.getElementById(n.ID+"inner");a.style.height=Math.round(n.totalHeight)+"px",a.style.width=Math.round(n.panelWidth)+"px",K();var o,r;n.pageTopOffsets=[],n.pageLeftOffsets=[];var s=n.numPages;for(o=0;s>o;o+=n.pagesPerRow)r=Math.floor(o/n.pagesPerRow),M(r)&&(n.firstRowLoaded=n.firstRowLoaded<0?r:n.firstRowLoaded,A(r),n.lastRowLoaded=r)},oe=function(e){27==e.keyCode&&se()},re=function(t){if(n.outerObject.toggleClass("diva-fullscreen"),e("body").toggleClass("diva-hide-scrollbar"),n.parentObject.toggleClass("diva-full-width"),n.mobileWebkit){var i=parseInt(n.outerObject.css("margin-left"),10)-parseInt(e("body").css("margin-left"),10);n.outerObject.css("margin-left",i)}var a=n.panelHeight,o=n.panelWidth;if(De(),n.oldZoomLevel>=0&&!n.inGrid){var l=n.panelHeight,s=n.panelWidth;n.inFullscreen?(n.verticalOffset-=(l-a)/2,n.horizontalOffset-=(s-o)/2):(n.verticalOffset+=(a-l)/2,n.horizontalOffset+=(o-s)/2)}t?(n.inGrid=!n.inGrid,le()):ee(),n.inFullscreen?e(document).on("keyup",oe):e(document).off("keyup",oe),diva.Events.publish("ModeDidSwitch",[n.inFullscreen],r)},le=function(){return ee(),diva.Events.publish("ViewDidSwitch",[n.inGrid],r),!0},se=function(){n.goDirectlyTo=n.currentPageIndex,n.inFullscreen=!n.inFullscreen,re(!1)},de=function(e){switch(n.goDirectlyTo=n.currentPageIndex,e){case"document":n.inGrid=!1,n.inBookLayout=!1;break;case"book":n.inGrid=!1,n.inBookLayout=!0;break;case"grid":n.inGrid=!0;break;default:return!1}return le()},ce=function(){return n.verticallyOriented=!n.verticallyOriented,n.verticalOffset=me(),n.horizontalOffset=be(),n.goDirectlyTo=n.currentPageIndex,n.inGrid?(n.inGrid=!1,le()):ae(),n.verticallyOriented},ue=function(t){var i=t.ctrlKey?n.zoomLevel-1:n.zoomLevel+1,a=Math.pow(2,i-n.zoomLevel),o=this.getBoundingClientRect(),r=document.getElementById(n.ID+"outer").getBoundingClientRect();n.doubleClickZoom=!0;var l=t.pageX-(r.left+n.panelWidth/2),s=t.pageY-(r.top+n.panelHeight/2);n.horizontalOffset=t.pageX-o.left-l/a,n.verticalOffset=t.pageY-o.top-s/a,n.verticalOffset+=n.verticallyOriented?n.verticalPadding/a:0,n.horizontalOffset+=n.verticallyOriented?0:n.horizontalPadding/a;var d=t.pageX+n.outerObject.scrollLeft()-r.left,c=t.pageY+n.outerObject.scrollTop()-r.top;n.goDirectlyTo=parseInt(e(this).attr("data-index"),10),fe(i,d,c)},ge=function(t){var i=parseInt(e(this).attr("data-index"),10);n.goDirectlyTo=i;var a=e(this).offset(),o=l(i,"w")/e(this).width();n.horizontalOffset=(t.pageX-a.left)*o,n.verticalOffset=(t.pageY-a.top)*o,n.inGrid=!1,le()},ve=function(t,i){var a=n.zoomLevel;if(t>100&&a<n.maxZoomLevel)a++;else{if(!(-100>t&&a>n.minZoomLevel))return;a--}n.scaleWait=!0;var o=e(this).offset();n.horizontalOffset=i.pageX-o.left,n.verticalOffset=i.pageY-o.top,n.goDirectlyTo=parseInt(e(this).attr("data-index"),10),fe(a)},he=function(e,t,i){var a=ie(n.zoomLevel);te(a.widthToSet,a.heightToSet);for(var o=X(n.currentPageIndex,n.verticalOffset,n.horizontalOffset),r={left:o.left,top:o.top,right:o.left+n.panelWidth,bottom:o.top+n.panelHeight},l=!1,s=0;s<n.numPages;s++)if(m(s,r))n.pagePreloadCanvases[s]=x(s,r),n.lastPageLoaded=s,l=!0;else if(l)break},fe=function(e,t,i){var a=Q(e),o=t||0,l=i||0;if(a!==e)return!1;var s=Math.pow(2,a-n.zoomLevel);if(n.doubleClickZoom)n.verticalOffset*=s,n.horizontalOffset*=s,n.doubleClickZoom=!1;else{n.goDirectlyTo=n.currentPageIndex;var d=s>1?0-n.verticalPadding:n.verticalPadding/2;n.verticalOffset=s*we()+d,n.horizontalOffset=s*Ie();var c=document.getElementById(n.ID+"outer").scrollTop,u=n.panelHeight;l=c+parseInt(u/2,10);var g=document.getElementById(n.ID+"outer").scrollLeft,v=n.panelWidth;o=g+parseInt(v/2,10)}n.oldZoomLevel=n.zoomLevel,n.zoomLevel=a;var h=o+"px "+l+"px";return n.innerObject.css("transform-origin",h),n.innerObject.css("transition","transform .3s cubic-bezier(0.000, 0.990, 1.000, 0.995)"),n.innerObject.css("pointer-events","none"),n.innerObject.css("transform","scale("+s+")"),he(),diva.Events.publish("ZoomLevelDidChange",[a],r),!0},pe=function(e){var t=J(e);return t!==e?!1:(n.pagesPerRow=t,diva.Events.publish("GridRowNumberDidChange",[t],r),n.goDirectlyTo=n.currentPageIndex,ne(),!0)},me=function(e,t){return e="undefined"==typeof e?n.currentPageIndex:e,"center"===t||"centre"===t?parseInt(l(e,"h")/2,10):"bottom"===t?parseInt(l(e,"h")-n.panelHeight/2,10):parseInt(n.panelHeight/2,10)},be=function(e,t){return e="undefined"==typeof e?n.currentPageIndex:e,"left"===t?parseInt(n.panelWidth/2,10):"right"===t?parseInt(l(e,"w")-n.panelWidth/2,10):parseInt(l(e,"w")/2,10)},we=function(){var e=document.getElementById(n.ID+"outer").scrollTop,t=n.panelHeight;return e-n.pageTopOffsets[n.currentPageIndex]+parseInt(t/2,10)},Ie=function(){var e=document.getElementById(n.ID+"outer").scrollLeft,t=n.panelWidth;return e-n.pageLeftOffsets[n.currentPageIndex]+parseInt(t/2,10)},ye=function(){var e;e=n.inGrid?"g":n.inBookLayout?"b":"d";var t={f:n.inFullscreen,v:e,z:n.zoomLevel,n:n.pagesPerRow,i:n.enableFilename?n.pages[n.currentPageIndex].f:!1,p:n.enableFilename?!1:n.currentPageIndex+1,y:n.inGrid?!1:we(),x:n.inGrid?!1:Ie()};return t},xe=function(){var e,t=ye(),i=[];for(e in t)t[e]!==!1&&i.push(e+n.hashParamSuffix+"="+t[e]);return i.join("&")},Pe=function(){return location.protocol+"//"+location.host+location.pathname+location.search+"#"+xe()},De=function(){var e=document.getElementById(n.ID+"outer");return n.panelHeight=e.clientHeight-(e.scrollWidth>e.clientWidth?n.scrollbarWidth:0),
n.panelWidth=e.clientWidth-(e.scrollHeight>e.clientHeight?n.scrollbarWidth:0),n.horizontalOffset=Ie(),n.verticalOffset=we(),U(n.currentPageIndex,n.verticalOffset,n.horizontalOffset),!0},Le=function(){n.mobileWebkit||(n.outerObject.dragscrollable({dragSelector:".diva-dragger",acceptPropagatedEvent:!0}),n.innerObject.dragscrollable({dragSelector:".diva-dragger",acceptPropagatedEvent:!0})),n.outerObject.on("dblclick",".diva-document-page",function(e){e.ctrlKey||ue.call(this,e)}),n.outerObject.on("contextmenu",".diva-document-page",function(e){return e.ctrlKey?(clearTimeout(n.singleClickTimeout),n.singleClick?(ue.call(this,e),n.singleClick=!1):(n.singleClick=!0,n.singleClickTimeout=setTimeout(function(){n.singleClick=!1},500)),!1):void 0}),n.outerObject.on("dblclick",".diva-row",function(t){ge.call(e(t.target).parent(),t)})},Oe=function(){n.blockMobileMove&&e("body").bind("touchmove",function(e){var t=e.originalEvent;return t.preventDefault(),!1}),n.outerObject.kinetic({triggerHardware:!0});var t=[],i=[],a=0;n.outerObject.on("touchstart",".diva-document-page",function(e){2===e.originalEvent.touches.length&&(t=[e.originalEvent.touches[0].clientX,e.originalEvent.touches[0].clientY,e.originalEvent.touches[1].clientX,e.originalEvent.touches[1].clientY],a=Te(t[2],t[0],t[3],t[1]))}),n.outerObject.on("touchmove",".diva-document-page",function(e){if(2===e.originalEvent.touches.length){i=[e.originalEvent.touches[0].clientX,e.originalEvent.touches[0].clientY,e.originalEvent.touches[1].clientX,e.originalEvent.touches[1].clientY];var t=Te(i[2],i[0],i[3],i[1]),o=t-a;n.scaleWait||(n.goDirectlyTo=n.currentPageIndex,n.inGrid?(n.inGrid=!1,le()):ve.call(this,o,e))}});var o={},r=0,l=function(t){if(n.singleTap){var i={pageX:t.originalEvent.changedTouches[0].clientX,pageY:t.originalEvent.changedTouches[0].clientY};r=Te(o.pageX,i.pageX,o.pageY,i.pageY),50>r&&n.zoomLevel<n.maxZoomLevel&&(n.inGrid?ge.call(e(t.target).parent(),i):ue.call(this,i)),n.singleTap=!1,o={}}else n.singleTap=!0,o.pageX=t.originalEvent.changedTouches[0].clientX,o.pageY=t.originalEvent.changedTouches[0].clientY,n.singleTapTimeout=setTimeout(function(){n.singleTap=!1,o={}},250)};n.outerObject.on("touchend",".diva-page",l);var s="onorientationchange"in window?"orientationchange":"resize";e(window).bind(s,function(e){var t=n.panelWidth,i=n.panelHeight;De(),n.horizontalOffset-=(n.panelWidth-t)/2,n.verticalOffset-=(n.panelHeight-i)/2,n.goDirectlyTo=n.currentPageIndex,ee()})},Te=function(e,t,i,a){return Math.sqrt((e-t)*(e-t)+(i-a)*(i-a))},Ce=function(){n.innerObject.mouseover(function(){e(this).removeClass("diva-grabbing").addClass("diva-grab")}),n.innerObject.mouseout(function(){e(this).removeClass("diva-grab")}),n.innerObject.mousedown(function(){e(this).removeClass("diva-grab").addClass("diva-grabbing")}),n.innerObject.mouseup(function(){e(this).removeClass("diva-grabbing").addClass("diva-grab")}),Le();var t=function(){var e,t=document.getElementById(n.ID+"outer").scrollTop,i=document.getElementById(n.ID+"outer").scrollLeft;e=n.verticallyOriented||n.inGrid?t-n.previousTopScroll:i-n.previousLeftScroll,n.inGrid?G(e):k(e),n.previousTopScroll=t,n.previousLeftScroll=i,n.horizontalOffset=Ie(),n.verticalOffset=we()};n.outerObject.scroll(t);var i=38,a=40,o=37,r=39,l=32,s=33,d=34,c=36,u=35;e(document).keydown(function(e){if(!n.isActiveDiva)return!0;if(n.enableSpaceScroll&&!e.shiftKey&&e.keyCode===l||n.enableKeyScroll&&e.keyCode===d)return n.outerObject.scrollTop(document.getElementById(n.ID+"outer").scrollTop+n.panelHeight),!1;if(n.enableSpaceScroll||e.keyCode!==l||e.preventDefault(),n.enableKeyScroll){if(e.shiftKey||e.ctrlKey||e.metaKey)return!0;switch(e.keyCode){case s:return n.outerObject.scrollTop(document.getElementById(n.ID+"outer").scrollTop-n.panelHeight),!1;case i:return n.outerObject.scrollTop(document.getElementById(n.ID+"outer").scrollTop-n.arrowScrollAmount),!1;case a:return n.outerObject.scrollTop(document.getElementById(n.ID+"outer").scrollTop+n.arrowScrollAmount),!1;case o:return n.outerObject.scrollLeft(document.getElementById(n.ID+"outer").scrollLeft-n.arrowScrollAmount),!1;case r:return n.outerObject.scrollLeft(document.getElementById(n.ID+"outer").scrollLeft+n.arrowScrollAmount),!1;case c:return n.outerObject.scrollTop(0),!1;case u:return n.outerObject.scrollTop(n.totalHeight),!1;default:return!0}}return!0}),n.mobileWebkit?Oe():e(window).resize(function(){De(),clearTimeout(n.resizeTimer),n.resizeTimer=setTimeout(function(){n.goDirectlyTo=n.currentPageIndex,n.verticalOffset=we(),n.horizontalOffset=Ie(),ee()},200)}),diva.Events.subscribe("PanelSizeDidChange",De,n.ID);var g=document.getElementById(n.ID+"inner");g.addEventListener("transitionend",ae,!1)},Ee=function(){function t(e,t){var i;return function(){clearTimeout(i),i=setTimeout(function(){e()},t)}}var i='<div id="'+n.ID+'view-menu" class="diva-view-menu"><div class="diva-view-icon diva-button" id="'+n.ID+'view-icon" title="Change view"></div><div id="'+n.ID+'view-options" class="diva-view-options"></div></div>',a=n.enableLinkIcon?'<div class="diva-link-icon diva-button" id="'+n.ID+'link-icon" style="'+(n.enableGridIcon?"border-left: 0px":"")+'" title="Link to this page"></div>':"",o="slider"===n.enableZoomControls?'<input type="range" id="'+n.ID+'zoom-slider" class="zoom-slider" value="'+n.zoomLevel+'" min="'+n.minZoomLevel+'" max="'+n.maxZoomLevel+'">':"",l="buttons"===n.enableZoomControls?'<div id="'+n.ID+'zoom-out-button" class="diva-zoom-out-button diva-button" title="Zoom Out"></div><div id="'+n.ID+'zoom-in-button" class="diva-zoom-in-button diva-button" title="Zoom In"></div>':"",s="slider"===n.enableGridControls?'<input type="range" id="'+n.ID+'grid-slider" class="grid-slider" value="'+n.pagesPerRow+'" min="'+n.minPagesPerRow+'" max="'+n.maxPagesPerRow+'">':"",d="buttons"===n.enableGridControls?'<div id="'+n.ID+'grid-out-button" class="diva-grid-out-button diva-button" title="Zoom Out"></div><div id="'+n.ID+'grid-in-button" class="diva-grid-in-button diva-button" title="Zoom In"></div>':"",c=n.enableGotoPage?'<form id="'+n.ID+'goto-page" class="diva-goto-form"><input type="text" id="'+n.ID+'goto-page-input" / class="diva-input"> <input type="submit" value="Go" style="margin-top: 0px;" /></form>':"",u="slider"===n.enableZoomControls?'<div id="'+n.ID+'zoom-slider-label" class="diva-slider-label">Zoom level: <span id="'+n.ID+'zoom-level">'+n.zoomLevel+"</span></div>":"",g="buttons"===n.enableZoomControls?'<div id="'+n.ID+'zoom-buttons-label" class="diva-buttons-label">Zoom level: <span id="'+n.ID+'zoom-level">'+n.zoomLevel+"</span></div>":"",v="slider"===n.enableGridControls?'<div id="'+n.ID+'grid-slider-label" class="diva-slider-label">Pages per row: <span id="'+n.ID+'pages-per-row">'+n.pagesPerRow+"</span></div>":"",h="buttons"===n.enableGridControls?'<div id="'+n.ID+'grid-buttons-label" class="diva-buttons-label">Pages per row: <span id="'+n.ID+'pages-per-row">'+n.pagesPerRow+"</span></div>":"",p='<div class="diva-page-label">Page <span id="'+n.ID+'current-page">1</span> of <span id="'+n.ID+'num-pages">'+n.numPages+"</span></div>",m=n.enableFullscreen?'<div id="'+n.ID+'fullscreen" class="diva-fullscreen-icon diva-button" title="Toggle fullscreen mode"></div>':"",b='<div id="'+n.ID+'tools-left" class="diva-tools-left">'+o+l+s+d+u+g+v+h+'</div><div id="'+n.ID+'tools-right" class="diva-tools-right">'+m+a+i+'<div id="'+n.ID+'page-nav" class="diva-page-nav">'+c+p+"</div></div>";n.toolbarParentObject.prepend('<div id="'+n.ID+'tools" class="diva-tools">'+b+"</div>");var w=function(){var e="",t='<div class="diva-document-icon diva-button" id="'+n.ID+'document-icon" title="Document View"></div>',i='<div class="diva-book-icon diva-button" id="'+n.ID+'book-icon" title="Book View"></div>',a='<div class="diva-grid-icon diva-button" id="'+n.ID+'grid-icon" title="Grid View"></div>',o=document.getElementById(n.ID+"view-icon"),r=" diva-view-icon diva-button";n.inGrid?o.className="diva-grid-icon"+r:n.inBookLayout?o.className="diva-book-icon"+r:o.className="diva-document-icon"+r,(n.inGrid||n.inBookLayout)&&(e+=t),(n.inGrid||!n.inBookLayout)&&(e+=i),n.inGrid||(e+=a),document.getElementById(n.ID+"view-options").innerHTML=e};e(n.selector+"zoom-slider").on("input",function(e){var t=parseInt(this.value,10);fe(t)}),e(n.selector+"zoom-slider").on("change",function(e){var t=parseInt(this.value,10);t!==n.zoomLevel&&fe(t)});var I=function(e){fe(n.zoomLevel+e)};e(n.selector+"zoom-out-button").click(t(function(){I(-1)},300)),e(n.selector+"zoom-in-button").click(t(function(){I(1)},300)),e(n.selector+"grid-slider").on("input",function(e){var t=parseInt(this.value,10);pe(t)}),e(n.selector+"grid-slider").on("change",function(e){var t=parseInt(this.value,10);t!==n.zoomLevel&&pe(t)}),e(n.selector+"fullscreen").click(function(){se()}),e(n.selector+"grid-out-button").click(function(){pe(n.pagesPerRow-1)}),e(n.selector+"grid-in-button").click(function(){pe(n.pagesPerRow+1)}),e(n.selector+"view-icon").click(function(){e(n.selector+"view-options").toggle()}),e(n.selector+"view-options").on("click",".diva-button",function(t){var i,a=t.target.classList[0];"diva-document-icon"===a?i="document":"diva-book-icon"===a?i="book":"diva-grid-icon"===a&&(i="grid"),diva.Events.publish("UserDidChooseView",[i],r),e(n.selector+"view-options").hide()}),diva.Events.subscribe("UserDidChooseView",de,n.ID),e(document).mouseup(function(t){var i=e(n.selector+"view-options");i.is(t.target)||0!==i.has(t.target).length||t.target.id===n.ID+"view-icon"||i.hide()}),e(n.selector+"goto-page").submit(function(){var t=parseInt(e(n.selector+"goto-page-input").val(),10),i=t-1;return f(i)?n.inGrid?q(i):_(i):alert("Invalid page number"),!1});var y=e(n.selector+"link-icon");y.click(function(){if(e("body").prepend('<div id="'+n.ID+'link-popup" class="diva-popup diva-link-popup"><input id="'+n.ID+'link-popup-input" class="diva-input" type="text" value="'+Pe()+'"/></div>'),n.inFullscreen)e(n.selector+"link-popup").addClass("in-fullscreen");else{var t=y.offset().left-222+y.outerWidth(),i=y.offset().top+y.outerHeight()-1;e(n.selector+"link-popup").removeClass("in-fullscreen").css({top:i+"px",left:t+"px"})}return e("body").mouseup(function(t){var i=t.target.id;i!==n.ID+"link-popup"&&i!==n.ID+"link-popup-input"&&e(n.selector+"link-popup").remove()}),n.outerObject.scroll(function(){e(n.selector+"link-popup").remove()}),e(n.selector+"link-popup input").click(function(){e(this).focus().select()}),!1});var x=n.inGrid?"grid":"zoom";e(n.selector+x+"-slider").show(),e(n.selector+x+"-out-button").show(),e(n.selector+x+"-in-button").show(),e(n.selector+x+"-slider-label").show(),e(n.selector+x+"-buttons-label").show();var P={updateCurrentPage:function(){document.getElementById(n.ID+"current-page").textContent=parseInt(n.currentPageIndex,10)+1},setNumPages:function(e){document.getElementById(n.ID+"num-pages").textContent=e},updateZoomSlider:function(){n.zoomLevel!==e(n.selector+"zoom-slider").val()&&e(n.selector+"zoom-slider").val(n.zoomLevel),document.getElementById(n.ID+"zoom-level").textContent=n.zoomLevel},updateZoomButtons:function(){document.getElementById(n.ID+"zoom-level").textContent=n.zoomLevel},updateGridSlider:function(){n.pagesPerRow!==e(n.selector+"grid-slider").val()&&e(n.selector+"grid-slider").val(n.pagesPerRow),document.getElementById(n.ID+"pages-per-row").textContent=n.pagesPerRow},updateGridButtons:function(){document.getElementById(n.ID+"pages-per-row").textContent=n.pagesPerRow},closePopups:function(){e(".diva-popup").css("display","none")},switchView:function(t){e(n.selector+x+"-slider").hide(),e(n.selector+x+"-out-button").hide(),e(n.selector+x+"-in-button").hide(),e(n.selector+x+"-slider-label").hide(),e(n.selector+x+"-buttons-label").hide(),x=n.inGrid?"grid":"zoom",e(n.selector+x+"-slider").show(),e(n.selector+x+"-out-button").show(),e(n.selector+x+"-in-button").show(),e(n.selector+x+"-slider-label").show(),e(n.selector+x+"-buttons-label").show()},switchMode:function(){n.inFullscreen?(e(n.selector+"tools-left").addClass("in-fullscreen"),e(n.selector+"tools").addClass("diva-fullscreen-tools")):(e(n.selector+"tools-left").removeClass("in-fullscreen"),e(n.selector+"tools").removeClass("diva-fullscreen-tools"))},displayViewMenu:w};return P},Se=function(){if(window.divaPlugins){var t=[];e.each(window.divaPlugins,function(e,i){var a=i.pluginName[0].toUpperCase()+i.pluginName.substring(1);if(n["enable"+a]){var o=i.init(n,r);if(!o)return;var l=i.titleText||a+" plugin";if("function"==typeof i.handleClick){t.push('<div class="diva-'+i.pluginName+'-icon" title="'+l+'"></div>');var s=n.mobileWebkit?"touchend":"click";n.outerObject.on(s,".diva-"+i.pluginName+"-icon",function(e){i.handleClick.call(this,e,n,r)})}n.plugins.push(i)}}),t.length&&(n.pageTools='<div class="diva-page-tools">'+t.join("")+"</div>")}},ze=function(){clearTimeout(n.throbberTimeoutID),e(n.selector+"throbber").hide()},ke=function(e){var t=e;switch(t){case"d":n.inGrid=!1,n.inBookLayout=!1;break;case"b":n.inGrid=!1,n.inBookLayout=!0;break;case"g":n.inGrid=!0,n.inBookLayout=!1}},je=function(e){var t=e["@id"],i=/#xywh=([0-9]+,[0-9]+,[0-9]+,[0-9]+)/,a="",n=!0;if(/\/([0-9]+,[0-9]+,[0-9]+,[0-9]+)\//.test(t)){var o=t.split("/");a=o[o.length-4]}else if(i.test(t)){var r=i.exec(t);a=r[1]}else e.service&&e.service["@id"]&&(t=e.service["@id"],n=!1);n&&(t=t.split("/").slice(0,-4).join("/"));var l={url:t};if(a.length){var s=a.split(",");l.x=parseInt(s[0],10),l.y=parseInt(s[1],10),l.w=parseInt(s[2],10),l.h=parseInt(s[3],10)}return l},Me=function(e){var t=function(e,t){return e/Math.pow(2,t)},i=function(e,t){var i=Math.max(e,t);return Math.ceil(Math.log((i+1)/257)/Math.log(2))},a=function(e,t){for(var i=e.length;i--;)e[i]=t};diva.Events.publish("ManifestDidLoad",[e],this);var o=e.sequences[0];n.documentPaged="paged"===e.viewingHint||"paged"===o.viewingHint;for(var r,l,s,d,c,u,g,v,h,f=o.canvases,p=new Array(f.length),m=new Array(f.length),b=e.label,w=0,I=f.length;I>w;w++){v=f[w].images[0].resource,r=v.width||f[w].width,l=v.height||f[w].height,d=je(v),s=d.url,"/"!==s.slice(-1)&&(s+="/"),c=i(r,l),u=f[w].label;var y="non-paged"!==f[w].viewingHint;g=v.service["@context"],h="http://iiif.io/api/image/2/context.json"===g?2:"http://library.stanford.edu/iiif/image-api/1.1/context.json"===g?1.1:1,m[w]={mx_w:r,mx_h:l,mx_z:c,fn:u,url:s,api:h,paged:y},d.hasOwnProperty("x")&&(m[w].xoffset=d.x,m[w].yoffset=d.y),p[w]=c}var x=Math.min.apply(Math,p),P=0,D=100,L=new Array(x+1),O=new Array(x+1),T=new Array(x+1),C=new Array(x+1),E=new Array(x+1);a(L,0),a(O,0),a(T,0),a(C,0),a(E,0);var S,z,k,j=[],M=m.length;for(w=0;M>w;w++){S=[];for(var H=0;x+1>H;H++){z=Math.floor(t(m[w].mx_w,x-H)),k=Math.floor(t(m[w].mx_h,x-H)),S[H]={h:k,w:z},L[H]+=z,O[H]+=k,T[H]=Math.max(z,T[H]),C[H]=Math.max(k,C[H]);var A=m[w].mx_h/m[w].mx_w;P=Math.max(A,P),D=Math.min(A,D)}j[w]={d:S,m:m[w].mx_z,f:m[w].fn,url:m[w].url,api:m[w].api,paged:m[w].paged},m[w].hasOwnProperty("xoffset")&&(j[w].xoffset=m[w].xoffset,j[w].yoffset=m[w].yoffset)}var B=[],R=[];for(w=0;x+1>w;w++)B.push(L[w]/m.length),R.push(O[w]/m.length);var F={a_wid:B,a_hei:R,max_w:T,max_h:C,max_ratio:P,min_ratio:D,t_hei:O,t_wid:L},Z={item_title:b,dims:F,max_zoom:x,pgs:j};return Z},He=function(t){var i=('<div id="'+n.ID+'error" class="diva-error"><button id="'+n.ID+'error-close" class="diva-error-close" aria-label="Close dialog"></button><p><strong>Error</strong></p><p>'+t+"</p></div>",document.createElement("div"));i.id=n.ID+"error",i.setAttribute("class","diva-error");var a=document.createElement("button");a.id=n.ID+"error-close",a.setAttribute("class","diva-error-close"),a.setAttribute("aria-label","Close Dialog");var o=document.createElement("p");o.innerHTML="<strong>Error</strong></p><p>"+t+"</p>",i.appendChild(a),i.appendChild(o),n.outerObject.append(i),e(n.selector+"error-close").on("click",function(){i.remove()})},Ae=function(e,t,i){ze();var a="Invalid objectData setting. Error code: "+e.status+" "+i,o=0===n.objectData.lastIndexOf("http",0);if(o&&""===i){var r=n.objectData.replace(/https?:\/\//i,"").split(/[/?#]/)[0];location.hostname!==r&&(a+='<p>Attempted to access cross-origin data without CORS.</p><p>You may need to update your server configuration to support CORS. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/Installation#a-note-about-cross-site-requests" target="_blank">cross-site request documentation.</a></p>')}He(a)},Be=function(){n.loadedTiles=[];for(var e=n.numPages;e--;)n.loadedTiles[e]=[]},Re=function(t){var i;if(!t.hasOwnProperty("@context")||-1===t["@context"].indexOf("iiif")&&-1===t["@context"].indexOf("shared-canvas")?i=t:(n.isIIIF=!0,i=Me(t)),ze(),n.pages=i.pgs,n.maxRatio=i.dims.max_ratio,n.minRatio=i.dims.min_ratio,n.itemTitle=i.item_title,n.numPages=i.pgs.length,n.maxWidths=i.dims.max_w,n.maxHeights=i.dims.max_h,n.averageWidths=i.dims.a_wid,n.averageHeights=i.dims.a_hei,n.totalHeights=i.dims.t_hei,n.totalWidths=i.dims.t_wid,n.realMaxZoom=i.max_zoom,n.maxZoomLevel=n.maxZoomLevel>=0&&n.maxZoomLevel<=i.max_zoom?n.maxZoomLevel:i.max_zoom,n.minZoomLevel=n.minZoomLevel>=0&&n.minZoomLevel<=n.maxZoomLevel?n.minZoomLevel:0,n.zoomLevel=Q(n.zoomLevel),n.minPagesPerRow=Math.max(2,n.minPagesPerRow),n.maxPagesPerRow=Math.max(n.minPagesPerRow,n.maxPagesPerRow),diva.Events.subscribe("DocumentWillLoad",Be,n.ID),n.enableFilename){var a=e.getHashParam("i"+n.hashParamSuffix),o=s(a);f(o)&&(n.goDirectlyTo=o,n.currentPageIndex=o)}else{var r=parseInt(e.getHashParam("p"+n.hashParamSuffix),10)-1;f(r)&&(n.goDirectlyTo=r,n.currentPageIndex=r)}if(diva.Events.publish("NumberOfPagesDidChange",[n.numPages],this),n.enableAutoTitle&&(e(n.selector+"title").length?e(n.selector+"title").html(n.itemTitle):n.parentObject.prepend('<div id="'+n.ID+'title" class="diva-title">'+n.itemTitle+"</div>")),f(parseInt(n.goDirectlyTo),10)||(n.goDirectlyTo=0),n.adaptivePadding>0){var l=n.zoomLevel;n.horizontalPadding=parseInt(n.averageWidths[l]*n.adaptivePadding,10),n.verticalPadding=parseInt(n.averageHeights[l]*n.adaptivePadding,10)}else n.horizontalPadding=n.fixedPadding,n.verticalPadding=n.fixedPadding;n.pageTools.length&&(n.verticalPadding=Math.max(40,n.verticalPadding)),n.documentPaged&&(n.inBookLayout=!0);var d=e.getHashParam("v"+n.hashParamSuffix);ke(d)},Fe=function(){var t='<div id="'+n.ID+'throbber" class="diva-throbber"></div>';n.outerObject.append(t),n.throbberTimeoutID=setTimeout(function(){e(n.selector+"throbber").show()},n.throbberTimeout),e.ajax({url:n.objectData,cache:!0,dataType:"json",error:Ae,success:function(t,i,a){Re(t),diva.Events.publish("ObjectDidLoad",[n],r),De();var o=parseInt(e.getHashParam("y"+n.hashParamSuffix),10);isNaN(o)?n.verticalOffset=me(n.currentPageIndex,"top"):n.verticalOffset=o;var l=parseInt(e.getHashParam("x"+n.hashParamSuffix),10);isNaN(l)?0===n.goDirectlyTo&&n.inBookLayout&&n.verticallyOriented?n.horizontalOffset=0+n.horizontalPadding:n.horizontalOffset=be(n.currentPageIndex,"center"):n.horizontalOffset=l,n.inFullscreen?re(!1):ee(),De(),diva.Events.publish("ViewerDidLoad",[n],r),n.loaded=!0}})},Ze=function(){return n.loaded?!0:(console.warn("The viewer is not completely initialized. This is likely because it is still downloading data. To fix this, only call this function if the isReady() method returns true."),!1)},We=function(){n.scrollbarWidth=e.getScrollbarWidth(),n.mobileWebkit=void 0!==window.orientation,n.ID=e.generateId("diva-"),n.selector="#"+n.ID;var t=parseInt(n.ID,10);t>1&&(n.hashParamSuffix=t),n.parentObject.append('<div id="'+n.ID+'outer" class="diva-outer"></div>'),n.outerObject=e(n.selector+"outer"),n.outerObject.append('<div id="'+n.ID+'inner" class="diva-inner diva-dragger"></div>'),n.innerObject=e(n.selector+"inner");var i=parseInt(e.getHashParam("n"+n.hashParamSuffix),10);i>=n.minPagesPerRow&&i<=n.maxPagesPerRow&&(n.pagesPerRow=i);var a=e.getHashParam("z"+n.hashParamSuffix);""!==a&&(a=parseInt(a,10),a>=n.minZoomLevel&&(n.zoomLevel=a)),n.enableToolbar&&(n.toolbar=Ee(),diva.Events.subscribe("VisiblePageDidChange",n.toolbar.updateCurrentPage,n.ID),diva.Events.subscribe("ModeDidSwitch",n.toolbar.switchMode,n.ID),diva.Events.subscribe("ViewDidSwitch",n.toolbar.switchView,n.ID),diva.Events.subscribe("ViewDidSwitch",n.toolbar.displayViewMenu,n.ID),diva.Events.subscribe("ZoomLevelDidChange",n.toolbar.updateZoomSlider,n.ID),diva.Events.subscribe("ZoomLevelDidChange",n.toolbar.updateZoomButtons,n.ID),diva.Events.subscribe("ZoomLevelDidChange",n.toolbar.updateGridButtons,n.ID),diva.Events.subscribe("GridRowNumberDidChange",n.toolbar.updateGridSlider,n.ID),diva.Events.subscribe("NumberOfPagesDidChange",n.toolbar.setNumPages,n.ID),diva.Events.subscribe("ObjectDidLoad",n.toolbar.displayViewMenu,n.ID),diva.Events.subscribe("ObjectDidLoad",n.toolbar.switchView,n.ID),diva.Events.subscribe("ObjectDidLoad",function(){n.toolbar.setNumPages(n.numPages)},n.ID),diva.Events.subscribe("ViewerDidLoad",n.toolbar.switchMode,n.ID),diva.Events.subscribe("ViewerDidLoad",function(){n.toolbar.updateCurrentPage(n.currentPageIndex)},n.ID),diva.Events.subscribe("ViewerDidLoad",function(){n.toolbar.updateZoomButtons(n.zoomLevel)},n.ID));var o=e.getHashParam("f"+n.hashParamSuffix),r="true"===o;n.inFullscreen=n.inFullscreen&&"false"!==o||r,Fe(),Se(),Ce()};We(),this.getItemTitle=function(){return n.itemTitle},this.gotoPageByNumber=function(e,t,i){var a=parseInt(e,10)-1;return f(a)?(U(a,me(a,i),be(a,t)),!0):!1},this.gotoPageByIndex=function(e,t,i){return e=parseInt(e,10),f(e)?(U(e,me(e,i),be(e,t)),!0):!1},this.getNumberOfPages=function(){return Ze()?n.numPages:!1},this.getPageDimensionsAtZoomLevel=function(e,t){if(!Ze())return!1;t>n.maxZoomLevel&&(t=n.maxZoomLevel);var i=n.pages[parseInt(e,10)],a=i.d[parseInt(t,10)];return{width:a.w,height:a.h}},this.getCurrentPageDimensionsAtCurrentZoomLevel=function(){return this.getPageDimensionsAtZoomLevel(n.currentPageIndex,n.zoomLevel)},this.isReady=function(){return n.loaded},this.getCurrentPageIndex=function(){return n.currentPageIndex},this.getCurrentPageFilename=function(){return n.pages[n.currentPageIndex].f},this.getCurrentPageNumber=function(){return n.currentPageIndex+1},this.getFilenames=function(){for(var e=[],t=0;t<n.numPages;t++)e[t]=n.pages[t].f;return e},this.getZoomLevel=function(){return n.zoomLevel},this.getMaxZoomLevel=function(){return n.maxZoomLevel},this.getMaxZoomLevelForPage=function(e){return Ze?n.pages[e].m:!1},this.getMinZoomLevel=function(){return n.minZoomLevel},this.setZoomLevel=function(e){return n.inGrid&&(n.goDirectlyTo=n.currentPageIndex,n.inGrid=!1,le()),fe(e)},this.zoomIn=function(){return this.setZoomLevel(n.zoomLevel+1)},this.zoomOut=function(){return this.setZoomLevel(n.zoomLevel-1)},this.inViewport=function(e,t,i,a,o){var r=e-1,l=n.pageTopOffsets[r]+i,s=l+o,u=n.pageLeftOffsets[r]+t,g=u+a;return c(l,s)&&d(u,g)},this.isPageInViewport=function(e){return p(e)},this.isPageLoaded=function(e){return b(e)},this.toggleFullscreenMode=function(){se()},this.closePopups=function(){n.toolbar.closePopups()},this.enterFullscreenMode=function(){return n.inFullscreen?!1:(se(),!0)},this.leaveFullscreenMode=function(){return n.inFullscreen?(se(),!0):!1},this.changeView=function(e){return de(e)},this.enterGridView=function(){return n.inGrid?!1:(de("grid"),!0)},this.leaveGridView=function(){return n.inGrid?(n.goDirectlyTo=n.currentPageIndex,n.inGrid=!1,le(),!0):!1},this.gotoPageByName=function(e,t,i){var a=s(e);return f(a)?(U(a,me(a,i),be(a,t)),!0):!1},this.getPageIndex=function(e){return s(e)},this.getCurrentURL=function(){return Pe()},this.getURLHash=function(){return xe()},this.getState=function(){return ye()},this.getInstanceSelector=function(){return n.selector},this.getInstanceId=function(){return n.ID},this.getSettings=function(){return n},this.translateFromMaxZoomLevel=function(e){var t=n.maxZoomLevel-n.zoomLevel;return e/Math.pow(2,t)},this.translateToMaxZoomLevel=function(e){var t=n.maxZoomLevel-n.zoomLevel;return 0===t?e:e*Math.pow(2,t)},this.setState=function(e){var t;t=s(e.i),f(t)?n.goDirectlyTo=t:f(e.p)&&(n.goDirectlyTo=e.p);var i=parseInt(e.x,10),a=parseInt(e.y,10);e.z>=n.minZoomLevel&&e.z<=n.maxZoomLevel&&(n.zoomLevel=e.z),e.n>=n.minPagesPerRow&&e.n<=n.maxPagesPerRow&&(n.pagesPerRow=e.n),n.inFullscreen!==e.f?(ke(e.v),n.inFullscreen=e.f,re(!1),n.horizontalOffset=i,n.verticalOffset=a,U(t,n.verticalOffset,n.horizontalOffset)):(n.horizontalOffset=i,n.verticalOffset=a,"g"===e.v&&(!n.inGrid||n.inBookLayout)||"d"===e.v&&(n.inGrid||n.inBookLayout)||"b"===e.v&&!n.inBookLayout?(ke(e.v),le()):ee())},this.enableScrollable=function(){n.isScrollable||(Le(),n.enableKeyScroll=n.initialKeyScroll,n.enableSpaceScroll=n.initialSpaceScroll,n.outerObject.css("overflow","auto"),n.isScrollable=!0)},this.disableScrollable=function(){n.isScrollable&&(n.innerObject.hasClass("diva-dragger")&&n.innerObject.unbind("mousedown"),n.outerObject.unbind("dblclick"),n.outerObject.unbind("contextmenu"),n.outerObject.css("overflow","hidden"),n.initialKeyScroll=n.enableKeyScroll,n.initialSpaceScroll=n.enableSpaceScroll,n.enableKeyScroll=!1,n.enableSpaceScroll=!1,n.isScrollable=!1)},this.toggleOrientation=function(){return ce()},this.getPageOffset=function(e){return{top:parseInt(n.pageTopOffsets[e]),left:parseInt(n.pageLeftOffsets[e])}},this.getCurrentPageOffset=function(){return this.getPageOffset(n.currentPageIndex)},this.getPageDimensionsAtCurrentGridLevel=function(e){e=f(e)?e:n.currentPageIndex;var t=n.rowHeight-n.fixedPadding,i=n.fixedHeightGrid?(n.rowHeight-n.fixedPadding)*l(e,"w")/l(e,"h"):n.gridPageWidth;return{height:parseInt(t,10),width:parseInt(i,10)}},this.getPageIndexForPageXYValues=function(e,t){var i=document.getElementById(n.ID+"outer"),a=i.getBoundingClientRect(),o=a.top,r=a.left,l=a.bottom,s=a.right;if(r>e||e>s)return!1;if(o>t||t>l)return!1;for(var d=document.getElementsByClassName("diva-page"),c=d.length;c--;){var u=d[c],g=u.getBoundingClientRect();if(!(e<g.left||e>g.right||t<g.top||t>g.bottom))return u.getAttribute("data-index")}return!1},this.isVerticallyOriented=function(){return n.verticallyOriented},this.changeObject=function(t){n.loaded=!1,$(),n.throbberTimeoutID=setTimeout(function(){e(n.selector+"throbber").show()},n.throbberTimeout),n.objectData=t,e.ajax({url:n.objectData,cache:!0,dataType:"json",error:Ae,success:function(e,t,i){Re(e),ze(),ee(),n.loaded=!0}})},this.activate=function(){n.isActiveDiva=!0},this.deactivate=function(){n.isActiveDiva=!1},this.destroy=function(){e("body").removeClass("diva-hide-scrollbar"),n.parentObject.empty().removeData("diva"),diva.Events.publish("ViewerDidTerminate",[n],r),n.parentObject.removeAttr("style").removeAttr("class"),diva.Events.unsubscribeAll(n.ID)}};e.fn.diva=function(i){return this.each(function(){if(i.parentObject=e(this),!i.parentObject.data("diva")){var a=new t(this,i);i.parentObject.data("diva",a)}})}}(jQuery),function(e){window.divaPlugins.push(function(){var t={},i={init:function(i,a){function n(e){return Math.log(e)/Math.log(10)}var o,r,l,s,d;a.startScrolling=function(){return i.currentlyAutoScrolling?void console.warn("You are trying to start autoscrolling, but it is already scrolling."):(e("#"+i.ID+"autoscroll-toggle").text("Turn off"),r&&a.disableScrollable(),i.currentlyAutoScrolling=!0,void restartScrollingInterval())},restartScrollingInterval=function(){clearInterval(i.autoScrollInterval),i.verticallyOriented?i.autoScrollInterval=setInterval(function(){i.outerObject.scrollTop(i.outerObject.scrollTop()+o)},l):i.autoScrollInterval=setInterval(function(){i.outerObject.scrollLeft(i.outerObject.scrollLeft()+o)},l)},a.stopScrolling=function(){return i.currentlyAutoScrolling?(e("#"+i.ID+"autoscroll-toggle").text("Turn on"),r&&a.enableScrollable(),i.currentlyAutoScrolling=!1,void clearInterval(i.autoScrollInterval)):void console.warn("You are trying to stop autoscrolling, but it is not currently active.")},a.toggleScrolling=function(){i.currentlyAutoScrolling?a.stopScrolling():a.startScrolling()},a.changeRefresh=function(e){l=e,c()},a.changeScrollSpeed=function(t){d=t,c(),e("#"+i.ID+"autoscroll-pps").val(n(d)),i.currentlyAutoScrolling&&restartScrollingInterval()};var c=function(){l=s,o=d/(1e3/l),1>o&&(l*=1/o,o=d/(1e3/l))};if(a.disableManualScroll=function(){r=!0,i.currentlyAutoScrolling&&a.disableScrollable()},a.enableManualScroll=function(){r=!1,i.currentlyAutoScrolling&&a.enableScrollable()},i.currentlyAutoScrolling=!1,i.autoScrollInterval="",r=i.disableManualScroll||!1,l=i.autoScrollRefresh||50,s=l,a.changeScrollSpeed(i.scrollSpeed||10),e(window).on("keyup",function(e){e.shiftKey&&32===e.keyCode&&a.toggleScrolling()}),!i.disableAutoscrollPrefs){var u=function(a){if(i.inFullscreen){var n=e(i.selector+"tools"),o=n.css("right");t.jqObj.css({right:o,"margin-right":0,top:n.offset().top+n.outerHeight()+15})}else t.jqObj.css({right:e(window).width()-(i.outerObject.offset().left+i.outerObject.outerWidth())+i.scrollbarWidth,"margin-right":".6em"}),t.jqObj.offset({top:i.outerObject.offset().top+1})};diva.Events.subscribe("ModeDidSwitch",u,i.ID),diva.Events.subscribe("ViewerDidLoad",function(o){var r="<div id='"+i.ID+"autoscroll-prefs' class='diva-autoscroll-prefs diva-popup'><b>Autoscrolling options:</b><br><span class='diva-autoscroll-prefs-text'>Speed:</span><input type='range' id='"+i.ID+"autoscroll-pps' class='diva-autoscroll-pps diva-autoscroll-prefs-input' value='"+n(d)+"' min='0' max='3' step='0.1'><br><span class='diva-autoscroll-prefs-text'>Allow manual scroll:</span><input type='checkbox' id='"+i.ID+"autoscroll-manual' class='diva-autoscroll-manual diva-autoscroll-prefs-input' checked='checked'><br><button id='"+i.ID+"autoscroll-toggle' class='diva-autoscroll-prefs-toggle diva-autoscroll-prefs-input'> Turn on </button></div>";e("#"+i.ID+"page-nav").before("<div id='"+i.ID+"autoscroll-icon' class='diva-button diva-autoscroll-icon' title='Expand autoscroll options'></div>"),e("body").prepend(r),e("#"+i.ID+"autoscroll-pps").on("change",function(e){a.changeScrollSpeed(Math.pow(10,e.target.value))}),e("#"+i.ID+"autoscroll-manual").on("change",function(e){e.target.checked?a.enableManualScroll():a.disableManualScroll()}),e("#"+i.ID+"autoscroll-toggle").on("click",a.toggleScrolling),e("#"+i.ID+"autoscroll-icon").on("click",function(a){t.jqObj=e("#"+i.ID+"autoscroll-prefs"),"none"===t.jqObj.css("display")?(t.jqObj.css({display:"block"}),u(i.inFullscreen)):t.jqObj.css("display","none")})},i.ID)}},pluginName:"autoscroll",titleText:"Automatically scrolls page along primary axis"};return i}())}(jQuery),function(e){window.divaPlugins.push(function(){var t,i,a,n={},o={},r={},l={brightnessMax:150,brightnessMin:-100,brightnessStep:1,contrastMax:3,contrastMin:-1,contrastStep:.05,localStoragePrefix:"canvas-",mobileWebkitMaxZoom:2,rgbMax:50,rgbMin:-50,throbberFadeSpeed:200,throbberTimeout:100,buttons:["contrast","brightness","rotation","zoom"]},s=function(e){return e*Math.PI/180},d=function(e,t){var a=e.x-n.centerX,o=-(e.y-n.centerY),r=s(i.rotation.previous-t),l=Math.cos(r)*a-Math.sin(r)*o+n.centerX,d=-(Math.sin(r)*a+Math.cos(r)*o)+n.centerY;return{x:l,y:d}},c=function(e,i){var a=e.context,n=e.size/2,o=-(e.width/2),r=-(e.height/2);a.clearRect(0,0,e.size,e.size),a.save(),a.translate(n,n),a.rotate(s(i)),a.drawImage(t,o,r,e.width,e.height),a.restore(),e.data=a.getImageData(0,0,e.size,e.size)},u=function(){var e;for(e in i)if(i[e].current!==i[e].previous)return!0;return!1},g=function(){var e;for(e in i)i[e].previous=i[e].current},v=function(){c(o,i.rotation.current),m(o)},h=function(){var t=i.rotation.current,a=i.rotation.previous,o=i.zoom.current,l=i.zoom.previous;if(t!==a||o!==l){var s=e("#diva-canvas-wrapper").scrollLeft(),v=e("#diva-canvas-wrapper").scrollTop(),h=r.viewport.width/2,f=r.viewport.height/2,p=d({x:s+h,y:v+f},t),b=Math.pow(2,o-l),w=b*p.x-h,I=b*p.y-f;c(n,t),e("#diva-canvas-wrapper").scrollLeft(w),e("#diva-canvas-wrapper").scrollTop(I)}u()&&(m(n),g())},f=function(e){var t,i,a=e.data,n=e.context.createImageData(a),o=n.data;for(t=0,i=o.length;i>t;t++)o[t]=a.data[t];return n},p=function(e){var t=i[e].current!==i[e].previous,a=i[e].current!==i[e].initial;return t||a},m=function(e){var t,a,n,o,l,s,d,c,u=f(e),g=u.data,v=i.brightness.current,h=i.contrast.current,m=1+Math.min(r.brightnessMax,Math.max(r.brightnessMin,v))/r.brightnessMax,b=m*h,w=128-128*h,I=i.red.current,y=i.green.current,x=i.blue.current,P=p("red"),D=p("green"),L=p("blue"),O=p("brightness"),T=p("contrast"),C=O||T;
for(t=0,n=u.width;n>t;t++)for(a=0,o=u.height;o>a;a++)l=4*(a*n+t),s=g[l],d=g[l+1],c=g[l+2],s+d+c>0&&(P&&s&&(s+=I),D&&d&&(d+=y),L&&c&&(c+=x),C&&(s&&(s=s*b+w),d&&(d=d*b+w),c&&(c=c*b+w)),g[l]=s,g[l+1]=d,g[l+2]=c);e.context.clearRect(0,0,n,o),e.context.putImageData(u,0,0)},b=function(){var t=e("#diva-canvas-wrapper").scrollLeft()*o.scaleFactor,i=e("#diva-canvas-wrapper").scrollTop()*o.scaleFactor,a=Math.min(Math.round(r.viewport.height*o.scaleFactor),r.mapSize)-4,n=Math.min(Math.round(r.viewport.width*o.scaleFactor),r.mapSize)-4;e("#diva-map-viewbox").height(a).width(n).css({top:i,left:t})},w=function(t){o.canvas=document.getElementById("diva-canvas-minimap"),o.size=r.mapSize,o.canvas.width=o.size,o.canvas.height=o.size,o.context=o.canvas.getContext("2d"),o.context.fillRect(0,0,o.size,o.size),o.scaleFactor=r.mapSize/n.size,o.cornerX=n.cornerX*o.scaleFactor,o.cornerY=n.cornerY*o.scaleFactor,o.width=t.width*o.scaleFactor,o.height=t.height*o.scaleFactor,o.context.drawImage(t,o.cornerX,o.cornerY,o.width,o.height),o.data=o.context.getImageData(0,0,r.mapSize,r.mapSize),e("#diva-map-viewbox").show(),b()},I=function(i,a){t=new Image,t.crossOrigin="anonymous",t.onload=function(){n.size=Math.sqrt(t.width*t.width+t.height*t.height),n.canvas=document.getElementById("diva-canvas"),n.canvas.width=n.size,n.canvas.height=n.size,n.cornerX=(n.size-t.width)/2,n.cornerY=(n.size-t.height)/2,n.width=t.width,n.height=t.height,n.centerX=n.size/2,n.centerY=n.size/2,n.context=n.canvas.getContext("2d"),n.context.drawImage(t,n.cornerX,n.cornerY,n.width,n.height);try{n.data=n.context.getImageData(0,0,n.size,n.size)}catch(i){var o='<div id="diva-error" class="diva-error"><p><strong>Error</strong></p><p>'+i.message+"</p>";if("SecurityError"!==i.name)throw i;o+='<p>You may need to update your server configuration in order to use the image manipulation tools. For help, see the <a href="https://github.com/DDMAL/diva.js/wiki/The-API-and-Plugins#a-note-about-canvas-and-cross-site-data" target="_blank">canvas cross-site data documentation</a>.</p></div>',o+="</div>",e("#diva-canvas-backdrop").append(o),L()}void 0===a&&w(t),v(),h(n),L(),"function"==typeof a&&a.call(a)},t.src=i,(t.complete||void 0===t.complete)&&(t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",t.src=i)},y=function(){var t=i[a],n=t.current,o=t.transform?t.transform(n):n;e("#diva-canvas-value").html(o)},x=function(){e("#diva-canvas-slider").val(i[a].current)},P=function(e){var t,i=r.zoomWidthRatio*Math.pow(2,e),a=r.imageDir+"/",n=r.selectedPageIndex;if(r.isIIIF){var o=r.pages[n].api>1.1?"default":"native";t=encodeURI(r.pages[n].url+"full/"+i+",/0/"+o+".jpg")}else t=r.iipServerURL+"?FIF="+a+r.filename+"&WID="+i+"&CVT=JPEG";return t},D=function(){(i.zoom.current>0||r.mobileWebkit)&&e(r.selector+"throbber").addClass("canvas-throbber").show()},L=function(){e(r.selector+"throbber").removeClass("canvas-throbber").hide()},O=function(){var e,t={},a=!1,n=r.localStoragePrefix+r.filename;for(e in i)i[e].previous!==i[e].initial&&(t[e]=i[e].previous,a=!0);a?(r.pluginIcon.addClass("new"),localStorage.setObject(n,t)):(r.pluginIcon.removeClass("new"),localStorage.removeItem(n))},T=function(e,t){r.zoomLevel=e;var i=P(e);I(i,function(){o.scaleFactor=o.size/n.size,b(),O()})},C=function(t){var i=38,a=40,n=37,o=39;switch(t.keyCode){case i:return e("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop-r.arrowScrollAmount),!1;case a:return e("#diva-canvas-wrapper").scrollTop(document.getElementById("diva-canvas-wrapper").scrollTop+r.arrowScrollAmount),!1;case n:return e("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft-r.arrowScrollAmount),!1;case o:return e("#diva-canvas-wrapper").scrollLeft(document.getElementById("diva-canvas-wrapper").scrollLeft+r.arrowScrollAmount),!1}},E={init:function(t,s){var d=!!window.HTMLCanvasElement;if(!d)return!1;e.extend(r,l,t.canvasPlugin),r.inCanvas=!1,r.iipServerURL=t.iipServerURL,r.imageDir=t.imageDir,r.selector=t.selector,r.mobileWebkit=t.mobileWebkit,r.arrowScrollAmount=t.arrowScrollAmount,i={contrast:{initial:1,min:r.contrastMin,max:r.contrastMax,step:r.contrastStep,transform:function(e){return e.toFixed(2)},title:"Change the contrast"},brightness:{initial:0,min:r.brightnessMin,max:r.brightnessMax,step:r.brightnessStep,title:"Adjust the brightness"},rotation:{initial:0,min:0,max:359,step:1,transform:function(e){return e+"&deg;"},title:"Rotate the image"},zoom:{initial:0,min:0,max:0,step:1,title:"Adjust the zoom level"},red:{initial:0,min:r.rgbMin,max:r.rgbMax,step:1,title:"Adjust the red channel"},green:{initial:0,min:r.rgbMin,max:r.rgbMax,step:1,title:"Adjust the green channel"},blue:{initial:0,min:r.rgbMin,max:r.rgbMax,step:1,title:"Adjust the blue channel"}};var c=function(){var e,t,a;for(a in i)t=i[a],e=t.initial,t.current=e,t.previous=e};if(c(),e("#diva-canvas-backdrop").length)return!0;var g,f,p,m,w=[];for(m in r.buttons)f=r.buttons[m],p=i[f].title,g='<div class="'+f+'" title="'+p+'"></div>',w.push(g);var I=w.join(""),P='<div id="diva-canvas-tools"><div id="diva-canvas-toolbar"><div id="diva-canvas-close" title="Return to the document viewer"></div><div id="diva-canvas-minimise" title="Minimise the toolbar"></div><span id="diva-canvas-info">Test</span></div><div id="diva-canvas-toolwindow"><div id="diva-map-viewbox"></div><canvas id="diva-canvas-minimap"></canvas><div id="diva-canvas-buttons">'+I+'</div><div id="diva-canvas-pane"><p id="diva-canvas-tooltip"><span id="diva-canvas-mode">contrast</span>: <span id="diva-canvas-value">0</span> <span id="diva-canvas-reset" class="link">(Reset)</span></p><input type="range" id="diva-canvas-slider"></input></div><br /><div class="action-buttons"><a href="#" id="diva-canvas-reset-all">Reset all</a><a href="#" id="diva-canvas-apply">Apply</a></div></div></div>',E='<div id="diva-canvas-wrapper"><canvas id="diva-canvas"></canvas></div>',S='<div id="diva-canvas-backdrop">'+P+E+"</div>";e("body").append(S),r.mapSize=e("#diva-canvas-minimap").width(),e("#diva-canvas-buttons div").click(function(){e("#diva-canvas-buttons .clicked").removeClass("clicked"),z(e(this).attr("class"))});var z=function(t){a=t;var n=i[a];e("#diva-canvas-buttons ."+a).addClass("clicked"),e("#diva-canvas-mode").text(a);var o=n.current,r=n.transform?n.transform(o):o,l=document.getElementById("diva-canvas-slider");l.min=n.min,l.max=n.max,l.step=n.step,e("#diva-canvas-slider").val(o),e("#diva-canvas-value").html(r)};return z("contrast"),e("#diva-canvas-slider").on("input",function(e){i[a].current=parseFloat(this.value),y(),v()}),e("#diva-canvas-reset-all").click(function(){var e;for(e in i)i[e].current=i[e].initial;y(),x(),v()}),e("#diva-canvas-reset").click(function(){i[a].current=i[a].initial,y(),x(),v()}),e("#diva-canvas-apply").click(function(){u()&&(D(),setTimeout(function(){i.zoom.current!==i.zoom.previous?T(i.zoom.current):(h(),L(),O())},r.throbberTimeout))}),e("#diva-canvas-close").click(function(){e("body").removeClass("overflow-hidden"),n.context.clearRect(0,0,n.size,n.size),o.context.clearRect(0,0,o.size,o.size),e("#diva-canvas-wrapper").scrollTop(0).scrollLeft(0),e("#diva-canvas-backdrop").hide(),e("#diva-map-viewbox").hide(),L(),s.enableScrollable(),e(document).off("keydown",C),c(),y(),x(),e("#diva-canvas-buttons .clicked").removeClass("clicked"),z("contrast"),diva.Events.publish("CanvasViewDidHide")}),e("#diva-canvas-minimise").click(function(){e("#diva-canvas-toolwindow").slideToggle("fast")}),e(window).resize(function(){r.viewport={height:window.innerHeight-t.scrollbarWidth,width:window.innerWidth-t.scrollbarWidth},r.inCanvas&&b()}),e("#diva-canvas-wrapper").scroll(function(){r.inCanvas&&b()}),e("#diva-canvas-minimap, #diva-map-viewbox").mouseup(function(t){var i=e("#diva-canvas-minimap").offset(),a=(t.pageX-i.left)/o.scaleFactor,n=(t.pageY-i.top)/o.scaleFactor;e("#diva-canvas-wrapper").scrollTop(n-r.viewport.height/2),e("#diva-canvas-wrapper").scrollLeft(a-r.viewport.width/2)}),e("#diva-canvas").mousedown(function(){e(this).addClass("grabbing")}).mouseup(function(){e(this).removeClass("grabbing")}),r.mobileWebkit?e("#diva-canvas-wrapper").kinetic():e("#diva-canvas-wrapper").dragscrollable({acceptPropagatedEvent:!0}),diva.Events.subscribe("ObjectDidLoad",this.setupHook,t.ID),diva.Events.subscribe("ViewerDidTerminate",this.destroy,t.ID),diva.Events.subscribe("PageDidLoad",this.onPageLoad,t.ID),!0},pluginName:"canvas",titleText:"View the image on a canvas and adjust various settings",setupHook:function(e){r.viewport={height:window.innerHeight-e.scrollbarWidth,width:window.innerWidth-e.scrollbarWidth},r.minZoomLevel=e.minZoomLevel,r.maxZoomLevel=e.maxZoomLevel,r.mobileWebkit&&(r.maxZoomLevel=Math.min(r.maxZoomLevel,r.mobileWebkitMaxZoom)),i.zoom.min=r.minZoomLevel,i.zoom.max=r.maxZoomLevel},handleClick:function(t,n,o){var l,s=e(this).parent().parent(),d=e(s).attr("data-filename"),c=e(s).attr("data-index"),u=e(s).width()-1,g=n.zoomLevel;r.zoomWidthRatio=u/Math.pow(2,g),r.pluginIcon=e(this),r.pages=n.pages,r.isIIIF=n.isIIIF,r.selectedPageIndex=c,r.mobileWebkit&&(g=Math.min(r.maxZoomLevel,g)),r.filename=d,i.zoom.initial=g,i.zoom.current=g;var v=localStorage.getObject(r.localStoragePrefix+r.filename);if(v)for(l in v)i[l].current=v[l],l===a&&(y(),x()),"zoom"===l&&(g=v[l]);i.zoom.previous=g,e("body").addClass("overflow-hidden"),e("#diva-canvas-backdrop").show(),o.disableScrollable(),e(document).keydown(C),r.inCanvas=!0;var h=P(g);e("#diva-canvas-info").text(e(s).attr("title")),D(),diva.Events.publish("CanvasViewDidActivate",[s]),I(h)},onPageLoad:function(t,i,a){var n=r.localStoragePrefix+i;null!==localStorage.getItem(n)&&e(a).find(".diva-canvas-icon").addClass("new")},destroy:function(t,i){e("#diva-canvas-backdrop").remove()}};return E}())}(jQuery),function(e){window.divaPlugins.push(function(){var t={init:function(e,t){return!0},pluginName:"download",titleText:"Download image at the given zoom level",handleClick:function(t,i){var a,n=e(this).parent().parent(),o=e(n).attr("data-filename"),r=e(n).attr("data-index"),l=e(n).width()-1;if(i.isIIIF){var s=i.pages[r].api>1.1?"default":"native";a=encodeURI(i.pages[r].url+"full/"+l+",/0/"+s+".jpg")}else a=i.iipServerURL+"?FIF="+i.imageDir+"/"+o+"&WID="+l+"&CVT=JPEG";window.open(a)}};return t}())}(jQuery),function(e){window.divaPlugins.push(function(){var e={init:function(e,t){function i(i,a,n){var l=e.parentObject.data("highlights");if("undefined"!=typeof l){if(l.hasOwnProperty(i)){for(var s=document.getElementById(e.ID+"page-"+i).getElementsByClassName(e.ID+"highlight");s[0];)s[0].parentNode.removeChild(s[0]);var d,c=t.getInstanceId()+"page-"+i,u=document.getElementById(c),g=l[i].regions,v=l[i].colour,h=l[i].divClass,f=t.getMaxZoomLevel();if(e.inGrid){var p=t.getPageDimensionsAtZoomLevel(i,f).width,m=u.clientWidth,b=p/m;d=Math.log(b)/Math.log(2)}else d=f-t.getZoomLevel();for(var w=g.length;w--;){var I=document.createElement("div");I.style.width=r(g[w].width,d)+"px",I.style.height=r(g[w].height,d)+"px",I.style.top=r(g[w].uly,d)+"px",I.style.left=r(g[w].ulx,d)+"px",I.style.background=v,I.style.border="1px solid #555",I.style.position="absolute",I.style.zIndex=100,I.className=h,"undefined"!=typeof g[w].divID&&I.setAttribute("data-highlight-id",g[w].divID),u.appendChild(I)}}o(),diva.Events.publish("HighlightCompleted",[i,a,n])}}e.parentObject.data("highlights",{});var a,n,o=function(){var i,o,r,l=e.ID+"selected-highlight",s=document.getElementsByClassName(l);for(i=0;i<s.length;i++)o=s[i],o.id!==a&&(o.className=o.className.replace(" "+l,""),o.style.border="1px solid #555");if(t.isPageLoaded(n))for(r=document.querySelectorAll("*[data-highlight-id="+a+"]"),i=0;i<r.length;i++)o=r[i],o.className=o.className+" "+l,o.style.border="2px solid #000"};diva.Events.subscribe("PageDidLoad",i,e.ID);var r=function(e,t){return e/Math.pow(2,t)};t.resetHighlights=function(){for(var t=document.getElementById(e.ID+"inner"),i=e.ID+"highlight",a=t.getElementsByClassName(i),n=a.length;n--;){var o=a[n].parentNode;o.removeChild(a[n])}e.parentObject.data("highlights",{})},t.removeHighlightsOnPage=function(i){var a=e.parentObject.data("highlights");if(a.hasOwnProperty(i)){for(var n=t.getInstanceId()+"page-"+i,o=document.getElementById(n),r=o.getElementsByTagName("div"),l=a[i].divClass,s=r.length;s--;)r[s].className===l&&o.removeChild(r[s]);delete a[i]}},t.highlightOnPages=function(e,i,a,n){for(var o=e.length;o--;)t.highlightOnPage(e[o],i[o],a,n)},t.highlightOnPage=function(a,n,o,r){"undefined"==typeof o&&(o="rgba(255, 0, 0, 0.2)"),r="undefined"==typeof r?e.ID+"highlight":e.ID+"highlight "+r;var l=(t.getMaxZoomLevel(),e.parentObject.data("highlights"));return l[a]={regions:n,colour:o,divClass:r},t.isPageLoaded(a)&&i(a,null,null),!0},t.gotoHighlight=function(t){var i=e.parentObject.data("highlights");if(null!==document.getElementById(t)){for(var a=parseInt(document.getElementById(t).parentNode.getAttribute("data-index"),10),n=i[a].regions.length;n--;)if(i[a].regions[n].divID===t)return l(a,i[a].regions[n])}else for(var o=Object.keys(i),r=o.length;r--;)for(var s=i[o[r]].regions,d=s.length;d--;)if(s[d].divID===t)return l(o[r],s[d]);return console.warn("Diva just tried to find a highlight that doesn't exist."),!1};var l=function(i,r){var l=parseFloat(r.uly)+parseFloat(r.height)/2,s=parseFloat(r.ulx)+parseFloat(r.width)/2,d=t.translateFromMaxZoomLevel(l),c=t.translateFromMaxZoomLevel(s);i=parseInt(i,10),t.gotoPageByIndex(i);var u=t.getSettings().outerObject,g=u.scrollTop()+d-u.height()/2+e.verticalPadding,v=u.scrollLeft()+c-u.width()/2+e.horizontalPadding;return u.scrollTop(g),u.scrollLeft(v),a=r.divID,n=i,diva.Events.publish("SelectedHighlightChanged",[a,n]),o(),a},s=function(i){return e.verticallyOriented?t.translateFromMaxZoomLevel(parseFloat(i.uly)+parseFloat(i.height)/2):t.translateFromMaxZoomLevel(parseFloat(i.ulx)+parseFloat(i.width)/2)},d=function(i){var o,r,d,c,u,g,v,h,f,p,m=e.parentObject.data("highlights"),b=!1;if(a&&n){for(d=n,c=m[d].regions,u=c.length;u--;)if(c[u].divID==a){f=c[u],r=s(f);break}for(u=c.length,g=t.getPageDimensionsAtZoomLevel(d,t.getZoomLevel()),o=i?e.verticallyOriented?g.height:g.width:0,p=i?function(e,t,i){return e>t&&i>e}:function(e,t,i){return t>e&&e>i};u--;)f=c[u],v=s(f),f.divID!==a&&p(v,r,o)&&(b=!0,o=v,h=f);if(b)return l(d,h)}else d=0,r=0;var w,I=Object.keys(m),y=I.indexOf(d);for(w=i?y==I.length-1?I[0]:I[y+1]:0===y?I[I.length-1]:I[y-1],c=m[w].regions,u=c.length,g=t.getPageDimensionsAtZoomLevel(w,t.getMaxZoomLevel()),o=i?e.verticallyOriented?g.height:g.width:0,p=i?function(e,t){return t>e}:function(e,t){return e>t};u--;)f=c[u],v=s(f),p(v,o)&&(b=!0,o=v,h=f);return l(w,h)};return t.gotoNextHighlight=function(){return d(!0)},t.gotoPreviousHighlight=function(){return d(!1)},diva.Events.subscribe("ViewerDidTerminate",this.destroy,e.ID),!0},destroy:function(e,t){e.parentObject.removeData("highlights")},pluginName:"highlight",titleText:"Highlight regions of pages"};return e}())}(jQuery),function(e){window.divaPlugins.push(function(){var t={},i={init:function(i,a){function n(e,n,r){var l=i.parentObject.data("highlights");if("undefined"!=typeof l&&t.highlightsVisible){if(l.hasOwnProperty(e)){var s,d=a.getInstanceId()+"page-"+e,c=document.getElementById(d),u=l[e].regions,g=l[e].colour,v=l[e].divClass,h=a.getMaxZoomLevel();if(i.inGrid){var f=a.getPageDimensionsAtZoomLevel(e,h).width,p=c.clientWidth,m=f/p;s=Math.log(m)/Math.log(2)}else s=h-a.getZoomLevel();for(var b=u.length;b--;){var w=document.createElement("div");w.style.width=o(u[b].width,s)+"px",w.style.height=o(u[b].height,s)+"px",w.style.top=o(u[b].uly,s)+"px",w.style.left=o(u[b].ulx,s)+"px",w.style.background=g,w.style.border="1px solid #555",w.style.position="absolute",w.style.zIndex=100,w.className=v,"undefined"!=typeof u[b].name&&w.setAttribute("data-name",u[b].name),"undefined"!=typeof u[b].divID&&(w.id=u[b].divID),c.appendChild(w)}}diva.Events.publish("HighlightCompleted",[e,n,r])}}i.parentObject.data("highlights",{}),t.highlightedPages=[],diva.Events.subscribe("PageWillLoad",n,i.ID);var o=function(e,t){return e/Math.pow(2,t)};a.resetHighlights=function(){for(var e=document.getElementById(i.ID+"inner"),t=i.ID+"highlight",a=e.getElementsByClassName(t),n=a.length;n--;){var o=a[n].parentNode;o.removeChild(a[n])}i.parentObject.data("highlights",{})},a.removeHighlightsOnPage=function(e){var t=i.parentObject.data("highlights");if(t.hasOwnProperty(e)){for(var n=a.getInstanceId()+"page-"+e,o=document.getElementById(n),r=o.getElementsByTagName("div"),l=t[e].divClass,s=r.length;s--;)r[s].className===l&&o.removeChild(r[s]);delete t[e]}},a.hideHighlights=function(){t.highlightsVisible=!1;for(var e=i.ID+"highlight",a=document.getElementById(i.ID+"inner"),n=a.getElementsByClassName(e),o=n.length;o--;){var r=n[o].parentNode;r.removeChild(n[o])}},a.showHighlights=function(){t.highlightsVisible=!0;for(var e,a=document.getElementById(i.ID+"inner"),o=a.getElementsByClassName("diva-document-page"),r=0;r<o.length;r++){e=parseInt(o[r].getAttribute("data-index"),10);var s=i.parentObject.data("highlights");s.hasOwnProperty(e)?n(e,null,null):l(e)}},a.highlightOnPages=function(e,t,i,n){for(var o=e.length;o--;)a.highlightOnPage(e[o],t[o],i,n)},a.highlightOnPage=function(e,t,o,r){"undefined"==typeof o&&(o="rgba(255, 0, 0, 0.1)"),r="undefined"==typeof r?i.ID+"highlight":i.ID+"highlight "+r;var l=(a.getMaxZoomLevel(),i.parentObject.data("highlights"));return l[e]={regions:t,colour:o,divClass:r},a.isPageLoaded(e)&&n(e,null,null),!0},a.gotoHighlight=function(e){var t,n,o,r,l=i.parentObject.data("highlights"),s=!1;if(null!==document.getElementById(e)){t=parseInt(document.getElementById(e).parentNode.getAttribute("data-index"),10);for(var d=l[t].regions.length;d--;)if(l[t].regions[d].divID===e){n=l[t].regions[d],o=parseFloat(n.uly)+parseFloat(n.height)/2,r=parseFloat(n.ulx)+parseFloat(n.width)/2,s=!0;break}}else for(var c=Object.keys(l),u=c.length;u--;){for(var g=l[c[u]].regions,v=g.length;v--;)if(g[v].divID===e){t=c[u],n=g[v],o=parseFloat(n.uly)+parseFloat(n.height)/2,r=parseFloat(n.ulx)+parseFloat(n.width)/2,s=!0;break}if(s)break}if(!s)return console.warn("Diva just tried to find a highlight that doesn't exist."),!1;var h=a.getSettings().outerObject,f=a.translateFromMaxZoomLevel(o),p=a.translateFromMaxZoomLevel(r);a.gotoPageByIndex(t);var m=h.scrollTop()+f-h.height()/2+i.verticalPadding,b=h.scrollLeft()+p-h.width()/2+i.horizontalPadding;return h.scrollTop(m),h.scrollLeft(b),i.currentHighlight=e,!0};var r=function(e){return function(i,n,o){for(var r=i,l=i.length,s=[],d=0;l>d;d++){var c=r[d],u=c.resource.chars,g=c.on,v=g.slice(g.indexOf("#xywh=")+6),h=v.split(","),f={ulx:parseInt(h[0],10),uly:parseInt(h[1],10),width:parseInt(h[2],10),height:parseInt(h[3],10),name:u};s.push(f)}a.highlightOnPage(e,s),t.highlightedPages.push(e)}},l=function(i){var a=t.manifest.sequences[0].canvases;if(a[i].hasOwnProperty("otherContent"))for(var n=a[i].otherContent,o=0;o<n.length;o++)"sc:AnnotationList"===n[o]["@type"]&&e.ajax({url:n[o]["@id"],cache:!0,dataType:"json",success:r(i)})},s=function(e){t.manifest=e};diva.Events.subscribe("ManifestDidLoad",s,i.ID),diva.Events.subscribe("PageWillLoad",function(e){if(t.highlightsVisible){for(var i=0;i<t.highlightedPages.length;i++)if(t.highlightedPages[i]===e)return;l(e,t.manifest)}},i.ID);var d=[];return i.innerObject.on("mouseenter","."+i.ID+"highlight",function(e){var t=e.target,i=t.dataset.name,a=document.createElement("div");a.style.top=t.offsetTop+t.offsetHeight-1+"px",a.style.left=t.style.left,a.style.background="#fff",a.style.border="1px solid #555",a.style.position="absolute",a.style.zIndex=101,a.className="annotation-overlay",a.textContent=i,t.parentNode.appendChild(a),d.push(a)}),i.innerObject.on("mouseleave","."+i.ID+"highlight",function(e){for(;d.length;){var t=d.pop();t.parentNode.removeChild(t)}}),diva.Events.subscribe("ViewerDidLoad",function(){e("#"+i.ID+"page-nav").before('<div id="'+i.ID+'annotations-icon" class="diva-button diva-annotations-icon" title="Turn annotations on or off"></div>'),e(i.selector+"annotations-icon").addClass("annotations-icon-active"),e("#"+i.ID+"annotations-icon").on("click",function(n){t.highlightsVisible?(a.hideHighlights(),e(i.selector+"annotations-icon").removeClass("annotations-icon-active")):(a.showHighlights(),e(i.selector+"annotations-icon").addClass("annotations-icon-active"))})},i.ID),t.highlightsVisible=!0,!0},destroy:function(e,t){e.parentObject.removeData("highlights")},pluginName:"IIIFHighlight",titleText:"Highlight regions of pages"};return i}())}(jQuery),function(e){window.divaPlugins.push(function(){var t={init:function(t,i){var a=function(i){var a=function(e,t){var i=e.charAt(0).toUpperCase()+e.slice(1),a=i.replace("_"," ");return 0===t.indexOf("http://")&&(t='<a href="'+t+'" target="_blank">'+t+"</a>"),'<div class="metadata-row"><span class="metadata-label">'+a+':</span> <span class="metadata-value">'+t+"</span></div>"},n=function(e,t){for(var i=0;i<e.length;i++)if(e[i]["@language"]===t)return e[i]["@value"]},o=function(e){for(var t="",o=0;o<e.length;o++){var r=e[o];if(i.hasOwnProperty(r))if(i[r].constructor===Array){var l=n(i[r],"en");t+=a(r,l)}else t+=a(r,i[r])}return t},r='<div id="'+t.ID+'metadata" class="diva-modal">';if(r+=o(["label"]),i.hasOwnProperty("metadata"))for(var l=i.metadata,s=0;s<l.length;s++)if(l[s].value.constructor===Array){var d=n(l[s].value,"en");r+=a(l[s].label,d)}else r+=a(l[s].label,l[s].value);r+=o(["description","within","see_also","service","license","attribution"]),r+="</div>",t.parentObject.prepend(r),e(t.selector+"metadata").hide()};return diva.Events.subscribe("ManifestDidLoad",a,t.ID),t.parentObject.prepend('<div style="text-align: center; clear: both"><a href="#" id="'+t.ID+'metadata-link" class="diva-metadata-link">Details</a></div>'),e(t.selector+"metadata-link").on("click",function(i){e(t.selector+"metadata").fadeToggle("fast")}),!0},destroy:function(e,t){},pluginName:"IIIFMetadata",titleText:"Show metadata from a IIIF manifest"};return t}())}(jQuery),function(e){window.divaPlugins.push(function(){var e={init:function(e,t){void 0===e.pageAliases&&(e.pageAliases={}),void 0===e.pageAliasFunction&&(e.pageAliasFunction=function(){return!1}),t.getAliasForPageIndex=function(t){return e.pageAliases[t]||e.pageAliasFunction(t)||t+1},t.getPageIndexForAlias=function(i){for(var a=0;a<e.numPages;a++)if(t.getAliasForPageIndex(a)==i)return a;return!1},t.getPageIndicesForAlias=function(i){for(var a=[],n=0;n<e.numPages;n++)t.getAliasForPageIndex(n)==i&&a.push(n);return a},t.getCurrentAliasedPageIndex=function(){return t.getAliasForPageIndex(e.currentPageIndex)},t.gotoPageByAliasedNumber=function(e,i,a){return t.gotoPageByIndex(t.getPageIndexForAlias(e),i,a)};var i=function(){document.getElementById(this.getSettings().ID+"current-page").textContent=this.getCurrentAliasedPageIndex()},a=function(){var t=this.getSettings(),a=t.numPages;void 0!==t.newTotalPages?a=t.newTotalPages:void 0!==t.totalPageOffset&&(a+=t.totalPageOffset),document.getElementById(this.getSettings().ID+"num-pages").textContent=a,document.getElementById(this.getSettings().ID+"current-page").textContent=this.getCurrentAliasedPageIndex(),diva.Events.unsubscribe(["VisiblePageDidChange",t.toolbar.updateCurrentPage,e.ID]),diva.Events.subscribe("VisiblePageDidChange",i,e.ID)};diva.Events.subscribe("ViewerDidLoad",a,e.ID)},pluginName:"pagealias",titleText:"Re-aliases page indexes"};return e}())}(jQuery);
//# sourceMappingURL=diva.min.js.map
